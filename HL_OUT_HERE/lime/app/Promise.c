// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <lime/app/Promise.h>
extern hl_type t$lime_app_Future;
void lime_app_Future_new(lime__app__Future,vclosure*,bool*);
#include <hl/types/ArrayObj.h>
extern hl_type t$fun_2b2a2eb;
void wrapt$fun_e2ed85b(vclosure*,vdynamic*);
extern hl_type t$fun_e2ed85b;
lime__app__Future lime_app_Future_onComplete(lime__app__Future,vclosure*);
lime__app__Promise lime_app_Promise_error(lime__app__Promise,vdynamic*);
lime__app__Future lime_app_Future_onError(lime__app__Future,vclosure*);
lime__app__Promise lime_app_Promise_progress(lime__app__Promise,int,int);
extern hl_type t$fun_a4fdf42;
void wrapt$fun_354f561(vclosure*,int,int);
extern hl_type t$fun_354f561;
lime__app__Future lime_app_Future_onProgress(lime__app__Future,vclosure*);

void lime_app_Promise_new(lime__app__Promise r0) {
	bool *r3;
	lime__app__Future r1;
	vclosure *r2;
	r1 = (lime__app__Future)hl_alloc_obj(&t$lime_app_Future);
	r2 = NULL;
	r3 = NULL;
	lime_app_Future_new(r1,r2,r3);
	r0->future = r1;
	return;
}

lime__app__Promise lime_app_Promise_complete(lime__app__Promise r0,vdynamic* r1) {
	hl__types__ArrayObj r6;
	bool r3;
	lime__app__Future r4;
	vclosure *r9;
	vdynamic *r5;
	varray *r10;
	int r7, r8;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->isError;
	if( r3 ) goto label$60e7a79_2_38;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r3 = true;
	r4->isComplete = r3;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r4->value = r1;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r6 = r4->__completeListeners;
	if( !r6 ) goto label$60e7a79_2_38;
	r7 = 0;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r6 = r4->__completeListeners;
	label$60e7a79_2_19:
	if( r6 == NULL ) hl_null_access();
	r8 = r6->length;
	if( r7 >= r8 ) goto label$60e7a79_2_34;
	r8 = r6->length;
	if( ((unsigned)r7) < ((unsigned)r8) ) goto label$60e7a79_2_27;
	r9 = NULL;
	goto label$60e7a79_2_30;
	label$60e7a79_2_27:
	r10 = r6->array;
	r5 = ((vdynamic**)(r10 + 1))[r7];
	r9 = (vclosure*)r5;
	label$60e7a79_2_30:
	++r7;
	if( r9 == NULL ) hl_null_access();
	r9->hasValue ? ((void (*)(vdynamic*,vdynamic*))r9->fun)((vdynamic*)r9->value,r1) : ((void (*)(vdynamic*))r9->fun)(r1);
	goto label$60e7a79_2_19;
	label$60e7a79_2_34:
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r6 = NULL;
	r4->__completeListeners = r6;
	label$60e7a79_2_38:
	return r0;
}

lime__app__Promise lime_app_Promise_completeWith(lime__app__Promise r0,lime__app__Future r1) {
	lime__app__Future r2;
	vclosure *r3, *r4, *r5, *r6;
	if( r1 == NULL ) hl_null_access();
	r3 = hl_alloc_closure_ptr(&t$fun_2b2a2eb,lime_app_Promise_complete,r0);
	if( r3 ) goto label$60e7a79_3_5;
	r4 = NULL;
	goto label$60e7a79_3_6;
	label$60e7a79_3_5:
	r4 = hl_alloc_closure_ptr(&t$fun_e2ed85b,wrapt$fun_e2ed85b,r3);
	label$60e7a79_3_6:
	r2 = lime_app_Future_onComplete(r1,r4);
	r3 = hl_alloc_closure_ptr(&t$fun_2b2a2eb,lime_app_Promise_error,r0);
	if( r3 ) goto label$60e7a79_3_11;
	r4 = NULL;
	goto label$60e7a79_3_12;
	label$60e7a79_3_11:
	r4 = hl_alloc_closure_ptr(&t$fun_e2ed85b,wrapt$fun_e2ed85b,r3);
	label$60e7a79_3_12:
	r2 = lime_app_Future_onError(r1,r4);
	r5 = hl_alloc_closure_ptr(&t$fun_a4fdf42,lime_app_Promise_progress,r0);
	if( r5 ) goto label$60e7a79_3_17;
	r6 = NULL;
	goto label$60e7a79_3_18;
	label$60e7a79_3_17:
	r6 = hl_alloc_closure_ptr(&t$fun_354f561,wrapt$fun_354f561,r5);
	label$60e7a79_3_18:
	r2 = lime_app_Future_onProgress(r1,r6);
	return r0;
}

lime__app__Promise lime_app_Promise_error(lime__app__Promise r0,vdynamic* r1) {
	hl__types__ArrayObj r6;
	bool r3;
	lime__app__Future r4;
	vclosure *r9;
	vdynamic *r5;
	varray *r10;
	int r7, r8;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->isComplete;
	if( r3 ) goto label$60e7a79_4_38;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r3 = true;
	r4->isError = r3;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r4->error = r1;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r6 = r4->__errorListeners;
	if( !r6 ) goto label$60e7a79_4_38;
	r7 = 0;
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r6 = r4->__errorListeners;
	label$60e7a79_4_19:
	if( r6 == NULL ) hl_null_access();
	r8 = r6->length;
	if( r7 >= r8 ) goto label$60e7a79_4_34;
	r8 = r6->length;
	if( ((unsigned)r7) < ((unsigned)r8) ) goto label$60e7a79_4_27;
	r9 = NULL;
	goto label$60e7a79_4_30;
	label$60e7a79_4_27:
	r10 = r6->array;
	r5 = ((vdynamic**)(r10 + 1))[r7];
	r9 = (vclosure*)r5;
	label$60e7a79_4_30:
	++r7;
	if( r9 == NULL ) hl_null_access();
	r9->hasValue ? ((void (*)(vdynamic*,vdynamic*))r9->fun)((vdynamic*)r9->value,r1) : ((void (*)(vdynamic*))r9->fun)(r1);
	goto label$60e7a79_4_19;
	label$60e7a79_4_34:
	r4 = r0->future;
	if( r4 == NULL ) hl_null_access();
	r6 = NULL;
	r4->__errorListeners = r6;
	label$60e7a79_4_38:
	return r0;
}

lime__app__Promise lime_app_Promise_progress(lime__app__Promise r0,int r1,int r2) {
	hl__types__ArrayObj r6;
	bool r4;
	lime__app__Future r5;
	vclosure *r9;
	vdynamic *r10;
	varray *r11;
	int r7, r8;
	r5 = r0->future;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->isError;
	if( r4 ) goto label$60e7a79_5_31;
	r5 = r0->future;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->isComplete;
	if( r4 ) goto label$60e7a79_5_31;
	r5 = r0->future;
	if( r5 == NULL ) hl_null_access();
	r6 = r5->__progressListeners;
	if( !r6 ) goto label$60e7a79_5_31;
	r7 = 0;
	r5 = r0->future;
	if( r5 == NULL ) hl_null_access();
	r6 = r5->__progressListeners;
	label$60e7a79_5_16:
	if( r6 == NULL ) hl_null_access();
	r8 = r6->length;
	if( r7 >= r8 ) goto label$60e7a79_5_31;
	r8 = r6->length;
	if( ((unsigned)r7) < ((unsigned)r8) ) goto label$60e7a79_5_24;
	r9 = NULL;
	goto label$60e7a79_5_27;
	label$60e7a79_5_24:
	r11 = r6->array;
	r10 = ((vdynamic**)(r11 + 1))[r7];
	r9 = (vclosure*)r10;
	label$60e7a79_5_27:
	++r7;
	if( r9 == NULL ) hl_null_access();
	r9->hasValue ? ((void (*)(vdynamic*,int,int))r9->fun)((vdynamic*)r9->value,r1,r2) : ((void (*)(int,int))r9->fun)(r1,r2);
	goto label$60e7a79_5_16;
	label$60e7a79_5_31:
	return r0;
}

bool lime_app_Promise_get_isComplete(lime__app__Promise r0) {
	bool r1;
	lime__app__Future r2;
	r2 = r0->future;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->isComplete;
	return r1;
}

bool lime_app_Promise_get_isError(lime__app__Promise r0) {
	bool r1;
	lime__app__Future r2;
	r2 = r0->future;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->isError;
	return r1;
}

