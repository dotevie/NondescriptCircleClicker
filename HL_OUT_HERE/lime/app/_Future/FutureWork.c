// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <lime/app/_Future/FutureWork.h>
#include <lime/app/_Event_Dynamic_Void.h>
void lime_app__Future_FutureWork_threadPool_doWork(vdynamic*);
extern hl_type t$fun_0ecc9bc;
void lime_app__Future_FutureWork_threadPool_onComplete(vdynamic*);
void lime_app__Future_FutureWork_threadPool_onError(vdynamic*);
extern lime__app___Future__$FutureWork g$_lime_app__Future_FutureWork;
extern hl_type t$lime_system_ThreadPool;
void lime_system_ThreadPool_new(lime__system__ThreadPool,int*,int*);
void lime_app__Event_Dynamic_Void_add(lime__app___Event_Dynamic_Void,vdynamic*,bool*,int*);
void lime_system_ThreadPool_queue(lime__system__ThreadPool,vdynamic*);
extern hl_type t$_dyn;
extern hl_type t$vrt_868e6c3;
void lime_system_ThreadPool_sendComplete(lime__system__ThreadPool,vdynamic*);
extern hl_type t$vrt_36b0d64;
void lime_system_ThreadPool_sendError(lime__system__ThreadPool,vdynamic*);

void lime_app__Future_FutureWork_queue(vdynamic* r0) {
	bool *r8;
	lime__app___Future__$FutureWork r3;
	lime__system__ThreadPool r2;
	vclosure *r7;
	lime__app___Event_Dynamic_Void r6;
	int *r4, *r5;
	static vclosure cl$0 = { &t$fun_0ecc9bc, lime_app__Future_FutureWork_threadPool_doWork, 0 };
	static vclosure cl$1 = { &t$fun_0ecc9bc, lime_app__Future_FutureWork_threadPool_onComplete, 0 };
	static vclosure cl$2 = { &t$fun_0ecc9bc, lime_app__Future_FutureWork_threadPool_onError, 0 };
	r3 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r2 = r3->threadPool;
	if( r2 ) goto label$6ec512a_1_36;
	r2 = (lime__system__ThreadPool)hl_alloc_obj(&t$lime_system_ThreadPool);
	r4 = NULL;
	r5 = NULL;
	lime_system_ThreadPool_new(r2,r4,r5);
	r3 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r3->threadPool = r2;
	r3 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r2 = r3->threadPool;
	if( r2 == NULL ) hl_null_access();
	r6 = r2->doWork;
	if( r6 == NULL ) hl_null_access();
	r7 = &cl$0;
	r8 = NULL;
	r4 = NULL;
	lime_app__Event_Dynamic_Void_add(r6,((vdynamic*)r7),r8,r4);
	r3 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r2 = r3->threadPool;
	if( r2 == NULL ) hl_null_access();
	r6 = r2->onComplete;
	if( r6 == NULL ) hl_null_access();
	r7 = &cl$1;
	r8 = NULL;
	r4 = NULL;
	lime_app__Event_Dynamic_Void_add(r6,((vdynamic*)r7),r8,r4);
	r3 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r2 = r3->threadPool;
	if( r2 == NULL ) hl_null_access();
	r6 = r2->onError;
	if( r6 == NULL ) hl_null_access();
	r7 = &cl$2;
	r8 = NULL;
	r4 = NULL;
	lime_app__Event_Dynamic_Void_add(r6,((vdynamic*)r7),r8,r4);
	label$6ec512a_1_36:
	r3 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r2 = r3->threadPool;
	if( r2 == NULL ) hl_null_access();
	lime_system_ThreadPool_queue(r2,r0);
	return;
}

void lime_app__Future_FutureWork_threadPool_doWork(vdynamic* r0) {
	vvirtual *r5, *r7;
	lime__app___Future__$FutureWork r4;
	lime__system__ThreadPool r3;
	vdynamic *r1, *r6, *r8;
	hl_trap_ctx trap$0;
	hl_trap(trap$0,r1,label$6ec512a_2_15);
	if( r0 == NULL ) hl_null_access();
	r1 = (vdynamic*)hl_dyn_getp((vdynamic*)r0,251462363/*work*/,&t$_dyn);
	if( r1 == NULL ) hl_null_access();
	{
		r1 = (vdynamic*)hl_dyn_call((vclosure*)r1,NULL,0);
	}
	r4 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r3 = r4->threadPool;
	if( r3 == NULL ) hl_null_access();
	r5 = hl_alloc_virtual(&t$vrt_868e6c3);
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r0,-135672421/*promise*/,&t$_dyn);
	if( hl_vfields(r5)[0] ) *(vdynamic**)(hl_vfields(r5)[0]) = (vdynamic*)r6; else hl_dyn_setp(r5->value,-135672421/*promise*/,&t$_dyn,r6);
	if( hl_vfields(r5)[1] ) *(vdynamic**)(hl_vfields(r5)[1]) = (vdynamic*)r1; else hl_dyn_setp(r5->value,142895325/*result*/,&t$_dyn,r1);
	lime_system_ThreadPool_sendComplete(r3,((vdynamic*)r5));
	hl_endtrap(trap$0);
	goto label$6ec512a_2_25;
	label$6ec512a_2_15:
	r6 = NULL;
	r4 = (lime__app___Future__$FutureWork)g$_lime_app__Future_FutureWork;
	r3 = r4->threadPool;
	if( r3 == NULL ) hl_null_access();
	r7 = hl_alloc_virtual(&t$vrt_36b0d64);
	if( r0 == NULL ) hl_null_access();
	r8 = (vdynamic*)hl_dyn_getp((vdynamic*)r0,-135672421/*promise*/,&t$_dyn);
	if( hl_vfields(r7)[1] ) *(vdynamic**)(hl_vfields(r7)[1]) = (vdynamic*)r8; else hl_dyn_setp(r7->value,-135672421/*promise*/,&t$_dyn,r8);
	if( hl_vfields(r7)[0] ) *(vdynamic**)(hl_vfields(r7)[0]) = (vdynamic*)r1; else hl_dyn_setp(r7->value,321506647/*error*/,&t$_dyn,r1);
	lime_system_ThreadPool_sendError(r3,((vdynamic*)r7));
	label$6ec512a_2_25:
	return;
}

void lime_app__Future_FutureWork_threadPool_onComplete(vdynamic* r0) {
	vdynamic *r1, *r2;
	if( r0 == NULL ) hl_null_access();
	r1 = (vdynamic*)hl_dyn_getp((vdynamic*)r0,-135672421/*promise*/,&t$_dyn);
	if( r1 == NULL ) hl_null_access();
	r1 = (vdynamic*)hl_dyn_getp((vdynamic*)r1,533201480/*complete*/,&t$_dyn);
	if( r1 == NULL ) hl_null_access();
	r2 = (vdynamic*)hl_dyn_getp((vdynamic*)r0,142895325/*result*/,&t$_dyn);
	{
		vdynamic *args[] = {r2};
		r1 = (vdynamic*)hl_dyn_call((vclosure*)r1,args,1);
	}
	return;
}

void lime_app__Future_FutureWork_threadPool_onError(vdynamic* r0) {
	vdynamic *r1, *r2;
	if( r0 == NULL ) hl_null_access();
	r1 = (vdynamic*)hl_dyn_getp((vdynamic*)r0,-135672421/*promise*/,&t$_dyn);
	if( r1 == NULL ) hl_null_access();
	r1 = (vdynamic*)hl_dyn_getp((vdynamic*)r1,321506647/*error*/,&t$_dyn);
	if( r1 == NULL ) hl_null_access();
	r2 = (vdynamic*)hl_dyn_getp((vdynamic*)r0,321506647/*error*/,&t$_dyn);
	{
		vdynamic *args[] = {r2};
		r1 = (vdynamic*)hl_dyn_call((vclosure*)r1,args,1);
	}
	return;
}

