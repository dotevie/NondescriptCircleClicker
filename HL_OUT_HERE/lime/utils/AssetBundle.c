// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <lime/utils/AssetBundle.h>
extern hl_type t$haxe_ds_StringMap;
void haxe_ds_StringMap_new(haxe__ds__StringMap);
extern hl_type t$hl_types_ArrayObj;
void hl_types_ArrayObj_new(hl__types__ArrayObj);
#include <haxe/io/BytesInput.h>
extern hl_type t$haxe_io_BytesInput;
void haxe_io_BytesInput_new(haxe__io__BytesInput,haxe__io__Bytes,vdynamic*,vdynamic*);
lime__utils__AssetBundle lime_utils_AssetBundle___extractBundle(haxe__io__Input);
#include <sys/io/FileInput.h>
sys__io__FileInput sys_io_File_read(String,bool*);
lime__app__Future lime_app_Future_withValue(vdynamic*);
extern hl_type t$fun_9a8b984;
lime__app__Future lime_utils__Bytes_Bytes_Impl__loadFromFile(String);
lime__app__Future wrapt$fun_425acda(vclosure*,vdynamic*);
extern hl_type t$fun_425acda;
lime__app__Future lime_app_Future_then(lime__app__Future,vclosure*);
#include <haxe/ds/List.h>
#include <haxe/ds/_List/ListNode.h>
#include <_std/Date.h>
#include <lime/utils/CompressionAlgorithm.h>
haxe__ds__List haxe_zip_Reader_readZip(haxe__io__Input);
extern hl_type t$lime_utils_AssetBundle;
extern hl_type t$vrt_775c77c;
extern hl_type t$_bool;
extern hl_type t$haxe_io_Bytes;
extern hl_type t$String;
extern venum* g$adb1ca5;
haxe__io__Bytes lime_utils__Bytes_Bytes_Impl__decompress(haxe__io__Bytes,venum*);
void haxe_ds_StringMap_set(haxe__ds__StringMap,String,vdynamic*);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);

void lime_utils_AssetBundle_new(lime__utils__AssetBundle r0) {
	hl__types__ArrayObj r3;
	haxe__ds__StringMap r1;
	r1 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r1);
	r0->data = r1;
	r3 = (hl__types__ArrayObj)hl_alloc_obj(&t$hl_types_ArrayObj);
	hl_types_ArrayObj_new(r3);
	r0->paths = r3;
	return;
}

lime__utils__AssetBundle lime_utils_AssetBundle_fromBytes(haxe__io__Bytes r0) {
	haxe__io__BytesInput r1;
	lime__utils__AssetBundle r5;
	vdynamic *r2, *r3;
	r1 = (haxe__io__BytesInput)hl_alloc_obj(&t$haxe_io_BytesInput);
	r2 = NULL;
	r3 = NULL;
	haxe_io_BytesInput_new(r1,r0,r2,r3);
	r5 = lime_utils_AssetBundle___extractBundle(((haxe__io__Input)r1));
	return r5;
}

lime__utils__AssetBundle lime_utils_AssetBundle_fromFile(String r0) {
	bool *r2;
	lime__utils__AssetBundle r3;
	sys__io__FileInput r1;
	r2 = NULL;
	r1 = sys_io_File_read(r0,r2);
	r3 = lime_utils_AssetBundle___extractBundle(((haxe__io__Input)r1));
	return r3;
}

lime__app__Future lime_utils_AssetBundle_loadFromBytes(haxe__io__Bytes r0) {
	lime__utils__AssetBundle r2;
	lime__app__Future r1;
	r2 = lime_utils_AssetBundle_fromBytes(r0);
	r1 = lime_app_Future_withValue(((vdynamic*)r2));
	return r1;
}

lime__app__Future lime_utils_AssetBundle_loadFromFile(String r0) {
	lime__app__Future r1;
	vclosure *r2, *r3;
	static vclosure cl$0 = { &t$fun_9a8b984, lime_utils_AssetBundle_loadFromBytes, 0 };
	r1 = lime_utils__Bytes_Bytes_Impl__loadFromFile(r0);
	if( r1 == NULL ) hl_null_access();
	r2 = &cl$0;
	if( r2 ) goto label$1abfb01_5_6;
	r3 = NULL;
	goto label$1abfb01_5_7;
	label$1abfb01_5_6:
	r3 = hl_alloc_closure_ptr(&t$fun_425acda,wrapt$fun_425acda,r2);
	label$1abfb01_5_7:
	r1 = lime_app_Future_then(r1,r3);
	return r1;
}

lime__utils__AssetBundle lime_utils_AssetBundle___extractBundle(haxe__io__Input r0) {
	String r11;
	hl__types__ArrayObj r15;
	haxe__ds__StringMap r10;
	vvirtual *r7;
	venum *r13;
	haxe__io__Bytes r9, r12;
	bool r8;
	lime__utils__AssetBundle r3;
	haxe__ds__List r1;
	vdynamic *r6;
	haxe__ds___List__ListNode r4, r5;
	int r14;
	r1 = haxe_zip_Reader_readZip(r0);
	r3 = (lime__utils__AssetBundle)hl_alloc_obj(&t$lime_utils_AssetBundle);
	lime_utils_AssetBundle_new(r3);
	if( r1 == NULL ) hl_null_access();
	r4 = r1->h;
	label$1abfb01_6_5:
	if( !r4 ) goto label$1abfb01_6_35;
	if( r4 == NULL ) hl_null_access();
	r6 = r4->item;
	r7 = hl_to_virtual(&t$vrt_775c77c,(vdynamic*)r6);
	r5 = r4->next;
	r4 = r5;
	if( r7 == NULL ) hl_null_access();
	r8 = hl_vfields(r7)[0] ? (*(bool*)(hl_vfields(r7)[0])) : (bool)hl_dyn_geti(r7->value,131747344/*compressed*/,&t$_bool);
	if( !r8 ) goto label$1abfb01_6_24;
	r9 = hl_vfields(r7)[2] ? (*(haxe__io__Bytes*)(hl_vfields(r7)[2])) : (haxe__io__Bytes)hl_dyn_getp(r7->value,40064820/*data*/,&t$haxe_io_Bytes);
	if( r3 == NULL ) hl_null_access();
	r10 = r3->data;
	if( r10 == NULL ) hl_null_access();
	r11 = hl_vfields(r7)[5] ? (*(String*)(hl_vfields(r7)[5])) : (String)hl_dyn_getp(r7->value,37969014/*fileName*/,&t$String);
	r13 = (venum*)g$adb1ca5;
	r12 = lime_utils__Bytes_Bytes_Impl__decompress(r9,r13);
	haxe_ds_StringMap_set(r10,r11,((vdynamic*)r12));
	goto label$1abfb01_6_30;
	label$1abfb01_6_24:
	if( r3 == NULL ) hl_null_access();
	r10 = r3->data;
	if( r10 == NULL ) hl_null_access();
	r11 = hl_vfields(r7)[5] ? (*(String*)(hl_vfields(r7)[5])) : (String)hl_dyn_getp(r7->value,37969014/*fileName*/,&t$String);
	r9 = hl_vfields(r7)[2] ? (*(haxe__io__Bytes*)(hl_vfields(r7)[2])) : (haxe__io__Bytes)hl_dyn_getp(r7->value,40064820/*data*/,&t$haxe_io_Bytes);
	haxe_ds_StringMap_set(r10,r11,((vdynamic*)r9));
	label$1abfb01_6_30:
	r15 = r3->paths;
	if( r15 == NULL ) hl_null_access();
	r11 = hl_vfields(r7)[5] ? (*(String*)(hl_vfields(r7)[5])) : (String)hl_dyn_getp(r7->value,37969014/*fileName*/,&t$String);
	r14 = hl_types_ArrayObj_push(r15,((vdynamic*)r11));
	goto label$1abfb01_6_5;
	label$1abfb01_6_35:
	return r3;
}

