// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <lime/_internal/format/PNG.h>
#include <hl/types/ArrayDyn.h>
#include <openfl/_Vector/IntVector.h>
#include <lime/utils/ArrayBufferView.h>
#include <lime/utils/TAError.h>
#include <lime/graphics/ImageBuffer.h>
#include <lime/graphics/ImageType.h>
haxe__io__Bytes haxe_io_Bytes_alloc(int);
extern hl_type t$lime_utils_ArrayBufferView;
void lime_utils_ArrayBufferView_new(lime__utils__ArrayBufferView,vdynamic*,int);
extern hl_type t$_i32;
int hl_types_ArrayDyn_get_length(hl__types__ArrayDyn);
void lime_utils_ArrayBufferView_copyFromArray(lime__utils__ArrayBufferView,hl__types__ArrayDyn,int*);
extern hl_type t$_dyn;
extern hl_type t$hl_types_ArrayDyn;
void haxe_io_Bytes_blit(haxe__io__Bytes,int,haxe__io__Bytes,int,int);
extern String s$unimplemented;
extern venum* g$lime_utils_TAError_RangeError;
extern String s$ac96fc9;
extern hl_type t$lime_graphics_ImageBuffer;
void lime_graphics_ImageBuffer_new(lime__graphics__ImageBuffer,lime__utils__ArrayBufferView,int*,int*,int*,vdynamic*);
#include <hl/natives.h>
extern hl_type t$lime_graphics_Image;
void lime_graphics_Image_new(lime__graphics__Image,lime__graphics__ImageBuffer,int*,int*,int*,int*,vdynamic*,venum*);
#include <lime/system/CFFI.h>
bool lime_graphics_Image_get_premultiplied(lime__graphics__Image);
int lime_graphics_Image_get_format(lime__graphics__Image);
lime__graphics__Image lime_graphics_Image_clone(lime__graphics__Image);
bool lime_graphics_Image_set_premultiplied(lime__graphics__Image,bool);
int lime_graphics_Image_set_format(lime__graphics__Image,int);
extern lime__system__$CFFI g$_lime_system_CFFI;

lime__graphics__Image lime__internal_format_PNG_decodeBytes(haxe__io__Bytes r0,bool* r1) {
	lime__graphics__Image r31;
	String r24;
	openfl___Vector__IntVector r8;
	venum *r25, *r33;
	haxe__io__Bytes r5, r15, r22;
	bool r2;
	lime__graphics__ImageBuffer r28;
	double r26, r27;
	lime__utils__ArrayBufferView r9, r12;
	hl__types__ArrayDyn r7, r13;
	int *r16, *r29, *r30, *r32;
	vdynamic *r3, *r10, *r11, *r17;
	int r6, r14, r18, r19, r20, r21, r23;
	if( r1 ) goto label$a247644_1_3;
	r2 = true;
	goto label$a247644_1_4;
	label$a247644_1_3:
	r2 = *r1;
	label$a247644_1_4:
	r3 = NULL;
	r6 = 0;
	r5 = haxe_io_Bytes_alloc(r6);
	r7 = NULL;
	r8 = NULL;
	r9 = NULL;
	r10 = NULL;
	if( !r3 ) goto label$a247644_1_16;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r3,r6);
	goto label$a247644_1_149;
	label$a247644_1_16:
	if( !r7 ) goto label$a247644_1_37;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	r6 = 0;
	r12->byteOffset = r6;
	if( r7 == NULL ) hl_null_access();
	r6 = hl_types_ArrayDyn_get_length(r7);
	r12->length = r6;
	r6 = r12->length;
	r14 = r12->bytesPerElement;
	r6 = r6 * r14;
	r12->byteLength = r6;
	r6 = r12->byteLength;
	r15 = haxe_io_Bytes_alloc(r6);
	r12->buffer = r15;
	r16 = NULL;
	lime_utils_ArrayBufferView_copyFromArray(r12,r7,r16);
	goto label$a247644_1_149;
	label$a247644_1_37:
	if( !r8 ) goto label$a247644_1_61;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	if( r8 == NULL ) hl_null_access();
	r17 = (vdynamic*)hl_dyn_getp((vdynamic*)r8,-269630230/*__array*/,&t$_dyn);
	r13 = (hl__types__ArrayDyn)hl_dyn_castp(&r17,&t$_dyn,&t$hl_types_ArrayDyn);
	r6 = 0;
	r12->byteOffset = r6;
	if( r13 == NULL ) hl_null_access();
	r6 = hl_types_ArrayDyn_get_length(r13);
	r12->length = r6;
	r6 = r12->length;
	r14 = r12->bytesPerElement;
	r6 = r6 * r14;
	r12->byteLength = r6;
	r6 = r12->byteLength;
	r15 = haxe_io_Bytes_alloc(r6);
	r12->buffer = r15;
	r16 = NULL;
	lime_utils_ArrayBufferView_copyFromArray(r12,r13,r16);
	goto label$a247644_1_149;
	label$a247644_1_61:
	if( !r9 ) goto label$a247644_1_95;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	if( r9 == NULL ) hl_null_access();
	r15 = r9->buffer;
	r6 = r9->length;
	r14 = r9->byteOffset;
	r18 = r9->bytesPerElement;
	r19 = r12->bytesPerElement;
	r20 = r9->type;
	r21 = r12->type;
	if( r20 != r21 ) goto label$a247644_1_86;
	if( r15 == NULL ) hl_null_access();
	r20 = r15->length;
	r21 = r20 - r14;
	r22 = haxe_io_Bytes_alloc(r21);
	r12->buffer = r22;
	r22 = r12->buffer;
	if( r22 == NULL ) hl_null_access();
	r23 = 0;
	haxe_io_Bytes_blit(r22,r23,r15,r14,r21);
	goto label$a247644_1_88;
	label$a247644_1_86:
	r24 = (String)s$unimplemented;
	hl_throw((vdynamic*)r24);
	label$a247644_1_88:
	r20 = r12->bytesPerElement;
	r20 = r20 * r6;
	r12->byteLength = r20;
	r20 = 0;
	r12->byteOffset = r20;
	r12->length = r6;
	goto label$a247644_1_149;
	label$a247644_1_95:
	if( !r5 ) goto label$a247644_1_147;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	r6 = 0;
	r18 = 0;
	if( r6 >= r18 ) goto label$a247644_1_106;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_1_106:
	r18 = r12->bytesPerElement;
	r14 = r18 == 0 ? 0 : r6 % r18;
	r18 = 0;
	if( r14 == r18 ) goto label$a247644_1_112;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_1_112:
	if( r5 == NULL ) hl_null_access();
	r14 = r5->length;
	r18 = r12->bytesPerElement;
	if( r10 ) goto label$a247644_1_129;
	r20 = r14 - r6;
	r19 = r20;
	r21 = r12->bytesPerElement;
	r20 = r21 == 0 ? 0 : r14 % r21;
	r21 = 0;
	if( r20 == r21 ) goto label$a247644_1_124;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_1_124:
	r21 = 0;
	if( r19 >= r21 ) goto label$a247644_1_128;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_1_128:
	goto label$a247644_1_137;
	label$a247644_1_129:
	r20 = r10 ? r10->v.i : 0;
	r21 = r12->bytesPerElement;
	r20 = r20 * r21;
	r19 = r20;
	r20 = r6 + r19;
	if( r14 >= r20 ) goto label$a247644_1_137;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_1_137:
	r12->buffer = r5;
	r12->byteOffset = r6;
	r12->byteLength = r19;
	r26 = (double)r19;
	r20 = r12->bytesPerElement;
	r27 = (double)r20;
	r26 = r26 / r27;
	r20 = (int)r26;
	r12->length = r20;
	goto label$a247644_1_149;
	label$a247644_1_147:
	r24 = (String)s$ac96fc9;
	hl_throw((vdynamic*)r24);
	label$a247644_1_149:
	r28 = (lime__graphics__ImageBuffer)hl_alloc_obj(&t$lime_graphics_ImageBuffer);
	r16 = NULL;
	r29 = NULL;
	r30 = NULL;
	r11 = NULL;
	lime_graphics_ImageBuffer_new(r28,r12,r16,r29,r30,r11);
	r28 = lime_hl_png_decode_bytes(r0,r2,r28);
	if( !r28 ) goto label$a247644_1_166;
	r31 = (lime__graphics__Image)hl_alloc_obj(&t$lime_graphics_Image);
	r16 = NULL;
	r29 = NULL;
	r30 = NULL;
	r32 = NULL;
	r11 = NULL;
	r33 = NULL;
	lime_graphics_Image_new(r31,r28,r16,r29,r30,r32,r11,r33);
	return r31;
	label$a247644_1_166:
	r31 = NULL;
	return r31;
}

lime__graphics__Image lime__internal_format_PNG_decodeFile(String r0,bool* r1) {
	lime__graphics__Image r31;
	String r24;
	openfl___Vector__IntVector r8;
	venum *r25, *r33;
	haxe__io__Bytes r5, r15, r22;
	bool r2;
	lime__graphics__ImageBuffer r28;
	double r26, r27;
	lime__utils__ArrayBufferView r9, r12;
	hl__types__ArrayDyn r7, r13;
	int *r16, *r29, *r30, *r32;
	vdynamic *r3, *r10, *r11, *r17;
	int r6, r14, r18, r19, r20, r21, r23;
	if( r1 ) goto label$a247644_2_3;
	r2 = true;
	goto label$a247644_2_4;
	label$a247644_2_3:
	r2 = *r1;
	label$a247644_2_4:
	r3 = NULL;
	r6 = 0;
	r5 = haxe_io_Bytes_alloc(r6);
	r7 = NULL;
	r8 = NULL;
	r9 = NULL;
	r10 = NULL;
	if( !r3 ) goto label$a247644_2_16;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r3,r6);
	goto label$a247644_2_149;
	label$a247644_2_16:
	if( !r7 ) goto label$a247644_2_37;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	r6 = 0;
	r12->byteOffset = r6;
	if( r7 == NULL ) hl_null_access();
	r6 = hl_types_ArrayDyn_get_length(r7);
	r12->length = r6;
	r6 = r12->length;
	r14 = r12->bytesPerElement;
	r6 = r6 * r14;
	r12->byteLength = r6;
	r6 = r12->byteLength;
	r15 = haxe_io_Bytes_alloc(r6);
	r12->buffer = r15;
	r16 = NULL;
	lime_utils_ArrayBufferView_copyFromArray(r12,r7,r16);
	goto label$a247644_2_149;
	label$a247644_2_37:
	if( !r8 ) goto label$a247644_2_61;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	if( r8 == NULL ) hl_null_access();
	r17 = (vdynamic*)hl_dyn_getp((vdynamic*)r8,-269630230/*__array*/,&t$_dyn);
	r13 = (hl__types__ArrayDyn)hl_dyn_castp(&r17,&t$_dyn,&t$hl_types_ArrayDyn);
	r6 = 0;
	r12->byteOffset = r6;
	if( r13 == NULL ) hl_null_access();
	r6 = hl_types_ArrayDyn_get_length(r13);
	r12->length = r6;
	r6 = r12->length;
	r14 = r12->bytesPerElement;
	r6 = r6 * r14;
	r12->byteLength = r6;
	r6 = r12->byteLength;
	r15 = haxe_io_Bytes_alloc(r6);
	r12->buffer = r15;
	r16 = NULL;
	lime_utils_ArrayBufferView_copyFromArray(r12,r13,r16);
	goto label$a247644_2_149;
	label$a247644_2_61:
	if( !r9 ) goto label$a247644_2_95;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	if( r9 == NULL ) hl_null_access();
	r15 = r9->buffer;
	r6 = r9->length;
	r14 = r9->byteOffset;
	r18 = r9->bytesPerElement;
	r19 = r12->bytesPerElement;
	r20 = r9->type;
	r21 = r12->type;
	if( r20 != r21 ) goto label$a247644_2_86;
	if( r15 == NULL ) hl_null_access();
	r20 = r15->length;
	r21 = r20 - r14;
	r22 = haxe_io_Bytes_alloc(r21);
	r12->buffer = r22;
	r22 = r12->buffer;
	if( r22 == NULL ) hl_null_access();
	r23 = 0;
	haxe_io_Bytes_blit(r22,r23,r15,r14,r21);
	goto label$a247644_2_88;
	label$a247644_2_86:
	r24 = (String)s$unimplemented;
	hl_throw((vdynamic*)r24);
	label$a247644_2_88:
	r20 = r12->bytesPerElement;
	r20 = r20 * r6;
	r12->byteLength = r20;
	r20 = 0;
	r12->byteOffset = r20;
	r12->length = r6;
	goto label$a247644_2_149;
	label$a247644_2_95:
	if( !r5 ) goto label$a247644_2_147;
	r12 = (lime__utils__ArrayBufferView)hl_alloc_obj(&t$lime_utils_ArrayBufferView);
	r6 = 0;
	r11 = hl_alloc_dynamic(&t$_i32);
	r11->v.i = r6;
	r6 = 4;
	lime_utils_ArrayBufferView_new(r12,r11,r6);
	r6 = 0;
	r18 = 0;
	if( r6 >= r18 ) goto label$a247644_2_106;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_2_106:
	r18 = r12->bytesPerElement;
	r14 = r18 == 0 ? 0 : r6 % r18;
	r18 = 0;
	if( r14 == r18 ) goto label$a247644_2_112;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_2_112:
	if( r5 == NULL ) hl_null_access();
	r14 = r5->length;
	r18 = r12->bytesPerElement;
	if( r10 ) goto label$a247644_2_129;
	r20 = r14 - r6;
	r19 = r20;
	r21 = r12->bytesPerElement;
	r20 = r21 == 0 ? 0 : r14 % r21;
	r21 = 0;
	if( r20 == r21 ) goto label$a247644_2_124;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_2_124:
	r21 = 0;
	if( r19 >= r21 ) goto label$a247644_2_128;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_2_128:
	goto label$a247644_2_137;
	label$a247644_2_129:
	r20 = r10 ? r10->v.i : 0;
	r21 = r12->bytesPerElement;
	r20 = r20 * r21;
	r19 = r20;
	r20 = r6 + r19;
	if( r14 >= r20 ) goto label$a247644_2_137;
	r25 = (venum*)g$lime_utils_TAError_RangeError;
	hl_throw((vdynamic*)r25);
	label$a247644_2_137:
	r12->buffer = r5;
	r12->byteOffset = r6;
	r12->byteLength = r19;
	r26 = (double)r19;
	r20 = r12->bytesPerElement;
	r27 = (double)r20;
	r26 = r26 / r27;
	r20 = (int)r26;
	r12->length = r20;
	goto label$a247644_2_149;
	label$a247644_2_147:
	r24 = (String)s$ac96fc9;
	hl_throw((vdynamic*)r24);
	label$a247644_2_149:
	r28 = (lime__graphics__ImageBuffer)hl_alloc_obj(&t$lime_graphics_ImageBuffer);
	r16 = NULL;
	r29 = NULL;
	r30 = NULL;
	r11 = NULL;
	lime_graphics_ImageBuffer_new(r28,r12,r16,r29,r30,r11);
	r28 = lime_hl_png_decode_file(r0,r2,r28);
	if( !r28 ) goto label$a247644_2_166;
	r31 = (lime__graphics__Image)hl_alloc_obj(&t$lime_graphics_Image);
	r16 = NULL;
	r29 = NULL;
	r30 = NULL;
	r32 = NULL;
	r11 = NULL;
	r33 = NULL;
	lime_graphics_Image_new(r31,r28,r16,r29,r30,r32,r11,r33);
	return r31;
	label$a247644_2_166:
	r31 = NULL;
	return r31;
}

haxe__io__Bytes lime__internal_format_PNG_encode(lime__graphics__Image r0) {
	lime__graphics__Image r2;
	haxe__io__Bytes r6;
	bool r1;
	lime__graphics__ImageBuffer r7;
	lime__system__$CFFI r5;
	int r3, r4, r8;
	if( r0 == NULL ) hl_null_access();
	r1 = lime_graphics_Image_get_premultiplied(r0);
	if( r1 ) goto label$a247644_3_6;
	r3 = lime_graphics_Image_get_format(r0);
	r4 = 0;
	if( r3 == r4 ) goto label$a247644_3_13;
	label$a247644_3_6:
	r2 = lime_graphics_Image_clone(r0);
	r0 = r2;
	if( r2 == NULL ) hl_null_access();
	r1 = false;
	r1 = lime_graphics_Image_set_premultiplied(r2,r1);
	r3 = 0;
	r3 = lime_graphics_Image_set_format(r2,r3);
	label$a247644_3_13:
	r5 = (lime__system__$CFFI)g$_lime_system_CFFI;
	r1 = r5->enabled;
	if( !r1 ) goto label$a247644_3_24;
	if( r0 == NULL ) hl_null_access();
	r7 = r0->buffer;
	r3 = 0;
	r4 = 0;
	r8 = 0;
	r6 = haxe_io_Bytes_alloc(r8);
	r6 = lime_hl_image_encode(r7,r3,r4,r6);
	return r6;
	label$a247644_3_24:
	r6 = NULL;
	return r6;
}

