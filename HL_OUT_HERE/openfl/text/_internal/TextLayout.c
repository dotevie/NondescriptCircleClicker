// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <openfl/text/_internal/TextLayout.h>
vdynamic* lime_text_harfbuzz__HBBuffer_HBBuffer_Impl___new(void);
#include <hl/natives.h>
vdynamic* lime_text_harfbuzz__HBLanguage_HBLanguage_Impl___new(String);
#include <lime/text/harfbuzz/HBGlyphInfo.h>
#include <lime/text/harfbuzz/HBGlyphPosition.h>
#include <openfl/text/_internal/GlyphPosition.h>
#include <lime/math/Vector2.h>
extern hl_type t$openfl_text__internal_GlyphPosition;
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern String s$;
int String___compare(String,vdynamic*);
haxe__io__Bytes haxe_io_Bytes_alloc(int);
void lime_text_Font___setSize(lime__text__Font,int);
vdynamic* lime_text_harfbuzz__HBFTFont_HBFTFont_Impl___new(lime__text__Font);
void lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__reset(vdynamic*);
int openfl_text__internal_TextLayout_get_direction(openfl__text___internal__TextLayout);
String openfl_text__internal_TextLayout_get_script(openfl__text___internal__TextLayout);
String openfl_text__internal_TextLayout_get_language(openfl__text___internal__TextLayout);
double lime_utils__DataPointer_DataPointer_Impl__fromCFFIPointer(vdynamic*);
void lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__addUTF16(vdynamic*,double,int,int,int);
void lime_text_harfbuzz_HB_shape(vdynamic*,vdynamic*,hl__types__ArrayObj);
hl__types__ArrayObj lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__getGlyphInfo(vdynamic*);
hl__types__ArrayObj lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__getGlyphPositions(vdynamic*);
double Math_min(double,double);
hl__types__ArrayObj openfl_text__internal_TextLayout_get_positions(openfl__text___internal__TextLayout);
extern hl_type t$lime_math_Vector2;
void lime_math_Vector2_new(lime__math__Vector2,double*,double*);
void openfl_text__internal_GlyphPosition_new(openfl__text___internal__GlyphPosition,int,lime__math__Vector2,lime__math__Vector2);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
hl__types__ArrayBytes_Int hl_types_ArrayBase_allocI32(vbyte*,int);
int hl_types_ArrayBytes_Int_push(hl__types__ArrayBytes_Int,int);
extern String s$Zyyy;
extern String s$en;

void openfl_text__internal_TextLayout___create(openfl__text___internal__TextLayout r0,int r1,String r2,String r3) {
	vdynamic *r7, *r8;
	int r5, r6;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->length;
	r6 = 4;
	if( r5 == r6 ) goto label$80f3f61_1_5;
	return;
	label$80f3f61_1_5:
	r7 = lime_text_harfbuzz__HBBuffer_HBBuffer_Impl___new();
	r0->__hbBuffer = r7;
	r7 = r0->__hbBuffer;
	switch(r1) {
		default:
		case 0:
		case 1:
		case 2:
		case 3:
			r6 = 0;
			goto label$80f3f61_1_18;
		case 4:
			r6 = 4;
			goto label$80f3f61_1_18;
		case 5:
			r6 = 5;
			goto label$80f3f61_1_18;
		case 6:
			r6 = 6;
			goto label$80f3f61_1_18;
		case 7:
			r6 = 7;
	}
	label$80f3f61_1_18:
	lime_hl_hb_buffer_set_direction(r7,r6);
	r5 = 1517910393;
	r7 = r0->__hbBuffer;
	lime_hl_hb_buffer_set_script(r7,r5);
	r7 = r0->__hbBuffer;
	r8 = lime_text_harfbuzz__HBLanguage_HBLanguage_Impl___new(r3);
	lime_hl_hb_buffer_set_language(r7,r8);
	return;
}

void openfl_text__internal_TextLayout___position(openfl__text___internal__TextLayout r0) {
	lime__text__Font r8, r12;
	String r6, r7;
	hl__types__ArrayObj r1, r17, r18;
	lime__math__Vector2 r30, r35;
	hl_type *r3;
	bool r13;
	haxe__io__Bytes r10;
	openfl__text___internal__GlyphPosition r29;
	lime__text__harfbuzz__HBGlyphInfo r23, r25;
	lime__text__harfbuzz__HBGlyphPosition r26, r27;
	double r15, r19, r33, r36, r37, r38, r39, r40, r41, r42;
	double *r32, *r34;
	vdynamic *r9, *r14;
	int r4, r11, r16, r20, r21, r22, r24, r28, r31;
	varray *r2;
	r3 = &t$openfl_text__internal_GlyphPosition;
	r4 = 0;
	r2 = hl_alloc_array(r3,r4);
	r1 = hl_types_ArrayObj_alloc(r2);
	r0->positions = r1;
	r6 = r0->text;
	if( !r6 ) goto label$80f3f61_2_197;
	r6 = r0->text;
	r7 = (String)s$;
	if( r6 == r7 || (r6 && r7 && String___compare(r6,(vdynamic*)r7) == 0) ) goto label$80f3f61_2_197;
	r8 = r0->font;
	if( !r8 ) goto label$80f3f61_2_197;
	r8 = r0->font;
	if( r8 == NULL ) hl_null_access();
	r9 = r8->src;
	if( !r9 ) goto label$80f3f61_2_197;
	r10 = r0->__buffer;
	if( r10 ) goto label$80f3f61_2_25;
	r6 = r0->text;
	if( r6 == NULL ) hl_null_access();
	r4 = r6->length;
	r11 = 5;
	r4 = r4 * r11;
	r10 = haxe_io_Bytes_alloc(r4);
	r0->__buffer = r10;
	label$80f3f61_2_25:
	r8 = r0->__font;
	r12 = r0->font;
	if( r8 == r12 ) goto label$80f3f61_2_43;
	r8 = r0->font;
	r0->__font = r8;
	r8 = r0->font;
	if( r8 == NULL ) hl_null_access();
	r4 = r0->size;
	lime_text_Font___setSize(r8,r4);
	r8 = r0->font;
	r9 = lime_text_harfbuzz__HBFTFont_HBFTFont_Impl___new(r8);
	r0->__hbFont = r9;
	r13 = r0->autoHint;
	if( !r13 ) goto label$80f3f61_2_42;
	r9 = r0->__hbFont;
	r4 = 0;
	lime_hl_hb_ft_font_set_load_flags(r9,r4);
	label$80f3f61_2_42:
	goto label$80f3f61_2_47;
	label$80f3f61_2_43:
	r8 = r0->font;
	if( r8 == NULL ) hl_null_access();
	r4 = r0->size;
	lime_text_Font___setSize(r8,r4);
	label$80f3f61_2_47:
	r9 = r0->__hbBuffer;
	if( r9 ) goto label$80f3f61_2_52;
	r9 = lime_text_harfbuzz__HBBuffer_HBBuffer_Impl___new();
	r0->__hbBuffer = r9;
	goto label$80f3f61_2_54;
	label$80f3f61_2_52:
	r9 = r0->__hbBuffer;
	lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__reset(r9);
	label$80f3f61_2_54:
	r9 = r0->__hbBuffer;
	r4 = openfl_text__internal_TextLayout_get_direction(r0);
	switch(r4) {
		default:
		case 0:
		case 1:
		case 2:
		case 3:
			r11 = 0;
			goto label$80f3f61_2_66;
		case 4:
			r11 = 4;
			goto label$80f3f61_2_66;
		case 5:
			r11 = 5;
			goto label$80f3f61_2_66;
		case 6:
			r11 = 6;
			goto label$80f3f61_2_66;
		case 7:
			r11 = 7;
	}
	label$80f3f61_2_66:
	lime_hl_hb_buffer_set_direction(r9,r11);
	r9 = r0->__hbBuffer;
	r6 = openfl_text__internal_TextLayout_get_script(r0);
	r4 = 1517910393;
	lime_hl_hb_buffer_set_script(r9,r4);
	r9 = r0->__hbBuffer;
	r6 = openfl_text__internal_TextLayout_get_language(r0);
	r14 = lime_text_harfbuzz__HBLanguage_HBLanguage_Impl___new(r6);
	lime_hl_hb_buffer_set_language(r9,r14);
	r4 = 2;
	r9 = r0->__hbBuffer;
	lime_hl_hb_buffer_set_cluster_level(r9,r4);
	r9 = r0->__hbBuffer;
	r6 = r0->text;
	r15 = lime_utils__DataPointer_DataPointer_Impl__fromCFFIPointer(((vdynamic*)r6));
	r6 = r0->text;
	if( r6 == NULL ) hl_null_access();
	r4 = r6->length;
	r11 = 0;
	r16 = -1;
	lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__addUTF16(r9,r15,r4,r11,r16);
	r9 = r0->__hbFont;
	r14 = r0->__hbBuffer;
	r1 = NULL;
	lime_text_harfbuzz_HB_shape(r9,r14,r1);
	r9 = r0->__hbBuffer;
	r1 = lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__getGlyphInfo(r9);
	r9 = r0->__hbBuffer;
	r17 = lime_text_harfbuzz__HBBuffer_HBBuffer_Impl__getGlyphPositions(r9);
	if( !r1 ) goto label$80f3f61_2_197;
	if( !r17 ) goto label$80f3f61_2_197;
	r4 = -1;
	if( r1 == NULL ) hl_null_access();
	r11 = r1->length;
	r15 = (double)r11;
	if( r17 == NULL ) hl_null_access();
	r11 = r17->length;
	r19 = (double)r11;
	r15 = Math_min(r15,r19);
	r11 = (int)r15;
	r16 = 0;
	r20 = r11;
	label$80f3f61_2_108:
	if( r16 >= r20 ) goto label$80f3f61_2_197;
	r21 = r16;
	++r16;
	if( r1 == NULL ) hl_null_access();
	r24 = r1->length;
	if( ((unsigned)r21) < ((unsigned)r24) ) goto label$80f3f61_2_117;
	r25 = NULL;
	goto label$80f3f61_2_120;
	label$80f3f61_2_117:
	r2 = r1->array;
	r9 = ((vdynamic**)(r2 + 1))[r21];
	r25 = (lime__text__harfbuzz__HBGlyphInfo)r9;
	label$80f3f61_2_120:
	r23 = r25;
	if( r17 == NULL ) hl_null_access();
	r24 = r17->length;
	if( ((unsigned)r21) < ((unsigned)r24) ) goto label$80f3f61_2_126;
	r27 = NULL;
	goto label$80f3f61_2_129;
	label$80f3f61_2_126:
	r2 = r17->array;
	r9 = ((vdynamic**)(r2 + 1))[r21];
	r27 = (lime__text__harfbuzz__HBGlyphPosition)r9;
	label$80f3f61_2_129:
	r26 = r27;
	r24 = 1;
	r22 = r4 + r24;
	if( r25 == NULL ) hl_null_access();
	r24 = r25->cluster;
	label$80f3f61_2_134:
	if( r22 >= r24 ) goto label$80f3f61_2_160;
	++r22;
	r18 = openfl_text__internal_TextLayout_get_positions(r0);
	if( r18 == NULL ) hl_null_access();
	r29 = (openfl__text___internal__GlyphPosition)hl_alloc_obj(&t$openfl_text__internal_GlyphPosition);
	r28 = 0;
	r30 = (lime__math__Vector2)hl_alloc_obj(&t$lime_math_Vector2);
	r31 = 0;
	r19 = (double)r31;
	r32 = &r19;
	r31 = 0;
	r33 = (double)r31;
	r34 = &r33;
	lime_math_Vector2_new(r30,r32,r34);
	r35 = (lime__math__Vector2)hl_alloc_obj(&t$lime_math_Vector2);
	r31 = 0;
	r36 = (double)r31;
	r32 = &r36;
	r31 = 0;
	r37 = (double)r31;
	r34 = &r37;
	lime_math_Vector2_new(r35,r32,r34);
	openfl_text__internal_GlyphPosition_new(r29,r28,r30,r35);
	r28 = hl_types_ArrayObj_push(r18,((vdynamic*)r29));
	goto label$80f3f61_2_134;
	label$80f3f61_2_160:
	r18 = openfl_text__internal_TextLayout_get_positions(r0);
	if( r18 == NULL ) hl_null_access();
	r29 = (openfl__text___internal__GlyphPosition)hl_alloc_obj(&t$openfl_text__internal_GlyphPosition);
	if( r23 == NULL ) hl_null_access();
	r22 = r23->codepoint;
	r30 = (lime__math__Vector2)hl_alloc_obj(&t$lime_math_Vector2);
	if( r26 == NULL ) hl_null_access();
	r24 = r26->xAdvance;
	r38 = (double)r24;
	r39 = 64.;
	r38 = r38 / r39;
	r39 = r0->letterSpacing;
	r38 = r38 + r39;
	r32 = &r38;
	r24 = r26->yAdvance;
	r39 = (double)r24;
	r40 = 64.;
	r39 = r39 / r40;
	r34 = &r39;
	lime_math_Vector2_new(r30,r32,r34);
	r35 = (lime__math__Vector2)hl_alloc_obj(&t$lime_math_Vector2);
	r24 = r26->xOffset;
	r40 = (double)r24;
	r41 = 64.;
	r40 = r40 / r41;
	r32 = &r40;
	r24 = r26->yOffset;
	r41 = (double)r24;
	r42 = 64.;
	r41 = r41 / r42;
	r34 = &r41;
	lime_math_Vector2_new(r35,r32,r34);
	openfl_text__internal_GlyphPosition_new(r29,r22,r30,r35);
	r22 = hl_types_ArrayObj_push(r18,((vdynamic*)r29));
	r22 = r23->cluster;
	r4 = r22;
	goto label$80f3f61_2_108;
	label$80f3f61_2_197:
	return;
}

hl__types__ArrayObj openfl_text__internal_TextLayout_get_positions(openfl__text___internal__TextLayout r0) {
	hl__types__ArrayObj r3;
	bool r2;
	r2 = r0->__dirty;
	if( !r2 ) goto label$80f3f61_3_5;
	r2 = false;
	r0->__dirty = r2;
	openfl_text__internal_TextLayout___position(r0);
	label$80f3f61_3_5:
	r3 = r0->positions;
	return r3;
}

int openfl_text__internal_TextLayout_get_direction(openfl__text___internal__TextLayout r0) {
	int r1;
	r1 = r0->__direction;
	return r1;
}

int openfl_text__internal_TextLayout_set_direction(openfl__text___internal__TextLayout r0,int r1) {
	bool r3;
	int r2;
	r2 = r0->__direction;
	if( r1 != r2 ) goto label$80f3f61_5_3;
	return r1;
	label$80f3f61_5_3:
	r0->__direction = r1;
	r3 = true;
	r0->__dirty = r3;
	return r1;
}

lime__text__Font openfl_text__internal_TextLayout_set_font(openfl__text___internal__TextLayout r0,lime__text__Font r1) {
	lime__text__Font r2;
	bool r3;
	r2 = r0->font;
	if( r1 != r2 ) goto label$80f3f61_6_3;
	return r1;
	label$80f3f61_6_3:
	r0->font = r1;
	r3 = true;
	r0->__dirty = r3;
	return r1;
}

hl__types__ArrayBytes_Int openfl_text__internal_TextLayout_get_glyphs(openfl__text___internal__TextLayout r0) {
	hl__types__ArrayObj r4;
	openfl__text___internal__GlyphPosition r7;
	hl__types__ArrayBytes_Int r1;
	vdynamic *r8;
	varray *r9;
	int r3, r5, r6;
	vbyte *r2;
	r3 = 0;
	r2 = hl_alloc_bytes(r3);
	r3 = 0;
	r3 = 0;
	r1 = hl_types_ArrayBase_allocI32(r2,r3);
	r3 = 0;
	r4 = openfl_text__internal_TextLayout_get_positions(r0);
	label$80f3f61_7_7:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r3 >= r6 ) goto label$80f3f61_7_24;
	r6 = r4->length;
	if( ((unsigned)r3) < ((unsigned)r6) ) goto label$80f3f61_7_15;
	r7 = NULL;
	goto label$80f3f61_7_18;
	label$80f3f61_7_15:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r3];
	r7 = (openfl__text___internal__GlyphPosition)r8;
	label$80f3f61_7_18:
	++r3;
	if( r1 == NULL ) hl_null_access();
	if( r7 == NULL ) hl_null_access();
	r5 = r7->glyph;
	r5 = hl_types_ArrayBytes_Int_push(r1,r5);
	goto label$80f3f61_7_7;
	label$80f3f61_7_24:
	return r1;
}

String openfl_text__internal_TextLayout_get_language(openfl__text___internal__TextLayout r0) {
	String r1;
	r1 = r0->__language;
	return r1;
}

String openfl_text__internal_TextLayout_set_language(openfl__text___internal__TextLayout r0,String r1) {
	String r2;
	bool r3;
	r2 = r0->__language;
	if( r1 != r2 && (!r1 || !r2 || String___compare(r1,(vdynamic*)r2) != 0) ) goto label$80f3f61_9_3;
	return r1;
	label$80f3f61_9_3:
	r0->__language = r1;
	r3 = true;
	r0->__dirty = r3;
	return r1;
}

String openfl_text__internal_TextLayout_get_script(openfl__text___internal__TextLayout r0) {
	String r1;
	r1 = r0->__script;
	return r1;
}

String openfl_text__internal_TextLayout_set_script(openfl__text___internal__TextLayout r0,String r1) {
	String r2;
	bool r3;
	r2 = r0->__script;
	if( r1 != r2 && (!r1 || !r2 || String___compare(r1,(vdynamic*)r2) != 0) ) goto label$80f3f61_11_3;
	return r1;
	label$80f3f61_11_3:
	r0->__script = r1;
	r3 = true;
	r0->__dirty = r3;
	return r1;
}

int openfl_text__internal_TextLayout_set_size(openfl__text___internal__TextLayout r0,int r1) {
	bool r3;
	int r2;
	r2 = r0->size;
	if( r1 != r2 ) goto label$80f3f61_12_3;
	return r1;
	label$80f3f61_12_3:
	r0->size = r1;
	r3 = true;
	r0->__dirty = r3;
	return r1;
}

String openfl_text__internal_TextLayout_set_text(openfl__text___internal__TextLayout r0,String r1) {
	String r2;
	bool r3;
	r2 = r0->text;
	if( r1 != r2 && (!r1 || !r2 || String___compare(r1,(vdynamic*)r2) != 0) ) goto label$80f3f61_13_3;
	return r1;
	label$80f3f61_13_3:
	r0->text = r1;
	r3 = true;
	r0->__dirty = r3;
	return r1;
}

void openfl_text__internal_TextLayout_new(openfl__text___internal__TextLayout r0,String r1,lime__text__Font r2,int* r3,int* r4,String r5,String r6) {
	lime__text__Font r11;
	String r7, r18;
	hl__types__ArrayObj r13;
	hl_type *r15;
	bool r16;
	double r10;
	varray *r14;
	int r8, r9, r12;
	if( r1 ) goto label$80f3f61_14_3;
	r7 = (String)s$;
	r1 = r7;
	label$80f3f61_14_3:
	if( r3 ) goto label$80f3f61_14_6;
	r8 = 12;
	goto label$80f3f61_14_7;
	label$80f3f61_14_6:
	r8 = *r3;
	label$80f3f61_14_7:
	if( r4 ) goto label$80f3f61_14_10;
	r9 = 4;
	goto label$80f3f61_14_11;
	label$80f3f61_14_10:
	r9 = *r4;
	label$80f3f61_14_11:
	if( r5 ) goto label$80f3f61_14_14;
	r7 = (String)s$Zyyy;
	r5 = r7;
	label$80f3f61_14_14:
	if( r6 ) goto label$80f3f61_14_17;
	r7 = (String)s$en;
	r6 = r7;
	label$80f3f61_14_17:
	r10 = 0.;
	r0->letterSpacing = r10;
	r7 = openfl_text__internal_TextLayout_set_text(r0,r1);
	r11 = openfl_text__internal_TextLayout_set_font(r0,r2);
	r12 = openfl_text__internal_TextLayout_set_size(r0,r8);
	r0->__direction = r9;
	r0->__script = r5;
	r0->__language = r6;
	r15 = &t$openfl_text__internal_GlyphPosition;
	r12 = 0;
	r14 = hl_alloc_array(r15,r12);
	r13 = hl_types_ArrayObj_alloc(r14);
	r0->positions = r13;
	r16 = true;
	r0->__dirty = r16;
	r12 = r0->__direction;
	r7 = r0->__script;
	r18 = r0->__language;
	openfl_text__internal_TextLayout___create(r0,r12,r7,r18);
	return;
}

