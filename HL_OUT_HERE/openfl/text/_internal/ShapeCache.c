// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <openfl/text/_internal/ShapeCache.h>
extern hl_type t$haxe_ds_StringMap;
void haxe_ds_StringMap_new(haxe__ds__StringMap);
vdynamic* String_charCodeAt(String,int);
#include <openfl/text/_internal/TextFormatRange.h>
#include <openfl/text/_internal/TextLayout.h>
#include <openfl/text/TextFormat.h>
#include <hl/types/ArrayObj.h>
hl__types__ArrayObj openfl_text__internal_ShapeCache___cacheLongWord(openfl__text___internal__ShapeCache,String,String,openfl__text___internal__TextLayout);
hl__types__ArrayObj openfl_text__internal_ShapeCache___cacheShortWord(openfl__text___internal__ShapeCache,String,String,openfl__text___internal__TextLayout);
bool haxe_ds_StringMap_exists(haxe__ds__StringMap,String);
vdynamic* haxe_ds_StringMap_get(haxe__ds__StringMap,String);
extern hl_type t$hl_types_ArrayObj;
extern hl_type t$_dyn;
hl__types__ArrayObj openfl_text__internal_TextLayout_get_positions(openfl__text___internal__TextLayout);
void haxe_ds_StringMap_set(haxe__ds__StringMap,String,vdynamic*);
#include <haxe/ds/IntMap.h>
#include <openfl/text/_internal/CacheMeasurement.h>
bool haxe_ds_IntMap_exists(haxe__ds__IntMap,int);
vdynamic* haxe_ds_IntMap_get(haxe__ds__IntMap,int);
bool openfl_text__internal_CacheMeasurement_exists(openfl__text___internal__CacheMeasurement,String);
hl__types__ArrayObj openfl_text__internal_CacheMeasurement_get(openfl__text___internal__CacheMeasurement,String);
void openfl_text__internal_CacheMeasurement_set(openfl__text___internal__CacheMeasurement,String,hl__types__ArrayObj);
extern hl_type t$openfl_text__internal_CacheMeasurement;
void openfl_text__internal_CacheMeasurement_new(openfl__text___internal__CacheMeasurement,String,hl__types__ArrayObj);
void haxe_ds_IntMap_set(haxe__ds__IntMap,int,vdynamic*);
extern hl_type t$haxe_ds_IntMap;
void haxe_ds_IntMap_new(haxe__ds__IntMap);

void openfl_text__internal_ShapeCache_new(openfl__text___internal__ShapeCache r0) {
	haxe__ds__StringMap r1;
	r1 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r1);
	r0->__shortWordMap = r1;
	r1 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r1);
	r0->__longWordMap = r1;
	return;
}

int openfl_text__internal_ShapeCache_hashFunction(String r0) {
	vdynamic *r6;
	int r1, r2, r3, r4, r5, r7;
	r1 = 0;
	r2 = 0;
	if( r0 == NULL ) hl_null_access();
	r3 = r0->length;
	label$bd39c4e_2_4:
	if( r2 >= r3 ) goto label$bd39c4e_2_19;
	r4 = r2;
	++r2;
	if( r0 == NULL ) hl_null_access();
	r6 = String_charCodeAt(r0,r4);
	r7 = 5;
	r5 = r1 << r7;
	r5 = r5 - r1;
	r7 = r6 ? r6->v.i : 0;
	r5 = r5 + r7;
	r7 = 0;
	r5 = r5 | r7;
	r1 = r5;
	goto label$bd39c4e_2_4;
	label$bd39c4e_2_19:
	return r1;
}

hl__types__ArrayObj openfl_text__internal_ShapeCache_cache(openfl__text___internal__ShapeCache r0,openfl__text___internal__TextFormatRange r1,openfl__text___internal__TextLayout r2) {
	String r3, r5;
	openfl__text__TextFormat r4;
	hl__types__ArrayObj r8;
	int r6, r7;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->format;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->__cacheKey;
	if( r2 == NULL ) hl_null_access();
	r5 = r2->text;
	if( r5 == NULL ) hl_null_access();
	r6 = r5->length;
	r7 = 15;
	if( r7 >= r6 ) goto label$bd39c4e_3_12;
	r8 = openfl_text__internal_ShapeCache___cacheLongWord(r0,r5,r3,r2);
	return r8;
	label$bd39c4e_3_12:
	r8 = openfl_text__internal_ShapeCache___cacheShortWord(r0,r5,r3,r2);
	return r8;
}

hl__types__ArrayObj openfl_text__internal_ShapeCache___cacheShortWord(openfl__text___internal__ShapeCache r0,String r1,String r2,openfl__text___internal__TextLayout r3) {
	hl__types__ArrayObj r9;
	haxe__ds__StringMap r6, r8;
	bool r5;
	vdynamic *r7;
	r6 = r0->__shortWordMap;
	if( r6 == NULL ) hl_null_access();
	r5 = haxe_ds_StringMap_exists(r6,r2);
	if( !r5 ) goto label$bd39c4e_4_18;
	r6 = r0->__shortWordMap;
	if( r6 == NULL ) hl_null_access();
	r7 = haxe_ds_StringMap_get(r6,r2);
	r6 = (haxe__ds__StringMap)r7;
	if( r6 == NULL ) hl_null_access();
	r5 = haxe_ds_StringMap_exists(r6,r1);
	if( !r5 ) goto label$bd39c4e_4_14;
	r7 = haxe_ds_StringMap_get(r6,r1);
	r9 = (hl__types__ArrayObj)hl_dyn_castp(&r7,&t$_dyn,&t$hl_types_ArrayObj);
	return r9;
	label$bd39c4e_4_14:
	if( r3 == NULL ) hl_null_access();
	r9 = openfl_text__internal_TextLayout_get_positions(r3);
	haxe_ds_StringMap_set(r6,r1,((vdynamic*)r9));
	goto label$bd39c4e_4_26;
	label$bd39c4e_4_18:
	r6 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r6);
	if( r3 == NULL ) hl_null_access();
	r9 = openfl_text__internal_TextLayout_get_positions(r3);
	haxe_ds_StringMap_set(r6,r1,((vdynamic*)r9));
	r8 = r0->__shortWordMap;
	if( r8 == NULL ) hl_null_access();
	haxe_ds_StringMap_set(r8,r2,((vdynamic*)r6));
	label$bd39c4e_4_26:
	r9 = openfl_text__internal_TextLayout_get_positions(r3);
	return r9;
}

hl__types__ArrayObj openfl_text__internal_ShapeCache___cacheLongWord(openfl__text___internal__ShapeCache r0,String r1,String r2,openfl__text___internal__TextLayout r3) {
	hl__types__ArrayObj r11;
	haxe__ds__StringMap r7;
	openfl__text___internal__CacheMeasurement r10;
	bool r6;
	haxe__ds__IntMap r9;
	vdynamic *r8;
	int r4;
	r4 = openfl_text__internal_ShapeCache_hashFunction(r1);
	r7 = r0->__longWordMap;
	if( r7 == NULL ) hl_null_access();
	r6 = haxe_ds_StringMap_exists(r7,r2);
	if( !r6 ) goto label$bd39c4e_5_29;
	r7 = r0->__longWordMap;
	if( r7 == NULL ) hl_null_access();
	r8 = haxe_ds_StringMap_get(r7,r2);
	r9 = (haxe__ds__IntMap)r8;
	if( r9 == NULL ) hl_null_access();
	r6 = haxe_ds_IntMap_exists(r9,r4);
	if( !r6 ) goto label$bd39c4e_5_23;
	r8 = haxe_ds_IntMap_get(r9,r4);
	r10 = (openfl__text___internal__CacheMeasurement)r8;
	if( r10 == NULL ) hl_null_access();
	r6 = openfl_text__internal_CacheMeasurement_exists(r10,r1);
	if( !r6 ) goto label$bd39c4e_5_19;
	r11 = openfl_text__internal_CacheMeasurement_get(r10,r1);
	return r11;
	label$bd39c4e_5_19:
	if( r3 == NULL ) hl_null_access();
	r11 = openfl_text__internal_TextLayout_get_positions(r3);
	openfl_text__internal_CacheMeasurement_set(r10,r1,r11);
	goto label$bd39c4e_5_28;
	label$bd39c4e_5_23:
	r10 = (openfl__text___internal__CacheMeasurement)hl_alloc_obj(&t$openfl_text__internal_CacheMeasurement);
	if( r3 == NULL ) hl_null_access();
	r11 = openfl_text__internal_TextLayout_get_positions(r3);
	openfl_text__internal_CacheMeasurement_new(r10,r1,r11);
	haxe_ds_IntMap_set(r9,r4,((vdynamic*)r10));
	label$bd39c4e_5_28:
	goto label$bd39c4e_5_40;
	label$bd39c4e_5_29:
	r9 = (haxe__ds__IntMap)hl_alloc_obj(&t$haxe_ds_IntMap);
	haxe_ds_IntMap_new(r9);
	r10 = (openfl__text___internal__CacheMeasurement)hl_alloc_obj(&t$openfl_text__internal_CacheMeasurement);
	if( r3 == NULL ) hl_null_access();
	r11 = openfl_text__internal_TextLayout_get_positions(r3);
	openfl_text__internal_CacheMeasurement_new(r10,r1,r11);
	r10->hash = r4;
	haxe_ds_IntMap_set(r9,r4,((vdynamic*)r10));
	r7 = r0->__longWordMap;
	if( r7 == NULL ) hl_null_access();
	haxe_ds_StringMap_set(r7,r2,((vdynamic*)r9));
	label$bd39c4e_5_40:
	r11 = openfl_text__internal_TextLayout_get_positions(r3);
	return r11;
}

