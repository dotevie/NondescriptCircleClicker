// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <flixel/util/_FlxSave/FlxSharedObject.h>
#include <lime/app/Application.h>
#include <lime/app/_Event_Int_Void.h>
void flixel_util__FlxSave_FlxSharedObject_onExit(int);
extern hl_type t$fun_8249ca6;
extern flixel__util___FlxSave__$FlxSharedObject g$e301e5e;
extern hl_type t$haxe_ds_StringMap;
void haxe_ds_StringMap_new(haxe__ds__StringMap);
extern lime__app__$Application g$_lime_app_Application;
void lime_app__Event_Int_Void_add(lime__app___Event_Int_Void,vdynamic*,bool*,int*);
vvirtual* haxe_ds_StringMap_iterator(haxe__ds__StringMap);
extern hl_type t$vrt_5488975;
extern hl_type t$fun_bf7849e;
extern hl_type t$fun_4525c7f;
vdynamic* flixel_util__FlxSave_FlxSharedObject_flush(flixel__util___FlxSave__FlxSharedObject,int*);
#include <openfl/display/Stage.h>
#include <openfl/display/MovieClip.h>
openfl__display__MovieClip openfl_Lib_get_current(void);
extern String s$company;
vdynamic* haxe_ds_StringMap_get(haxe__ds__StringMap,String);
extern String s$;
int String___compare(String,vdynamic*);
extern String s$HaxeFlixel;
String flixel_util_FlxSave_validate(String);
#include <openfl/errors/Error.h>
#include <_std/EReg.h>
#include <haxe/Unserializer.h>
hl__BaseType Type_resolveEnum(String);
extern hl_type t$fun_3522943;
hl__Class openfl_net_SharedObject___resolveClass(String);
extern hl_type t$fun_4b98509;
extern hl_type t$openfl_errors_Error;
extern String s$Error_Invalid_name_;
String String___add__(String,String);
extern String s$4e17057;
void openfl_errors_Error_new(openfl__errors__Error,String,int*);
extern String s$6666cd7;
bool haxe_ds_StringMap_exists(haxe__ds__StringMap,String);
extern hl_type t$EReg;
extern String s$f7ed234;
void EReg_new(EReg,String,String);
bool EReg_match(EReg,String);
extern String s$_not_allowed_in_localPath;
String flixel_util__FlxSave_FlxSharedObject_getData(String,String);
extern hl_type t$flixel_util__FlxSave_FlxSharedObject;
void flixel_util__FlxSave_FlxSharedObject_new(flixel__util___FlxSave__FlxSharedObject);
extern hl_type t$haxe_Unserializer;
void haxe_Unserializer_new(haxe__Unserializer,String);
extern hl_type t$vrt_fd8054d;
extern hl_type t$vrt_6c65511;
void haxe_Unserializer_setResolver(haxe__Unserializer,vvirtual*);
vdynamic* haxe_Unserializer_unserialize(haxe__Unserializer);
void haxe_ds_StringMap_set(haxe__ds__StringMap,String,vdynamic*);
String flixel_util__FlxSave_FlxSharedObject_getPath(String,String);
bool sys_FileSystem_exists(String);
String sys_io_File_getContent(String);
String openfl_net_SharedObject___getPath(String,String);
#include <hl/types/ArrayObj.h>
String lime_system_System_get_applicationStorageDirectory(void);
extern String s$ed4e360;
String haxe_io_Path_normalize(String);
extern String s$7bc0ee6;
String StringTools_replace(String,String,String);
bool StringTools_startsWith(String,String);
String String_substr(String,int,vdynamic*);
bool StringTools_endsWith(String,String);
extern hl_type t$_i32;
String String_substring(String,int,vdynamic*);
int String_indexOf(String,String,vdynamic*);
hl__types__ArrayObj String_split(String,String);
extern String s$01abfc7;
extern String s$_sol;
#include <sys/io/FileOutput.h>
#include <haxe/io/Encoding.h>
hl__types__ArrayObj Reflect_fields(vdynamic*);
String haxe_Serializer_run(vdynamic*);
String haxe_io_Path_directory(String);
void openfl_net_SharedObject___mkdir(String);
sys__io__FileOutput sys_io_File_write(String,bool*);
#include <haxe/io/Output.h>
void haxe_io_Output_writeString(haxe__io__Output,String,venum*);
void sys_io_FileOutput_close(sys__io__FileOutput);
void sys_FileSystem_deleteFile(String);
void openfl_net_SharedObject_new(openfl__net__SharedObject);

void flixel_util__FlxSave_FlxSharedObject_init() {
	bool *r7;
	lime__app__$Application r4;
	haxe__ds__StringMap r1;
	lime__app___Event_Int_Void r5;
	lime__app__Application r3;
	flixel__util___FlxSave__$FlxSharedObject r2;
	vclosure *r6;
	int *r8;
	static vclosure cl$0 = { &t$fun_8249ca6, flixel_util__FlxSave_FlxSharedObject_onExit, 0 };
	r2 = (flixel__util___FlxSave__$FlxSharedObject)g$e301e5e;
	r1 = r2->all;
	if( r1 ) goto label$b3b8fb0_1_17;
	r1 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r1);
	r2 = (flixel__util___FlxSave__$FlxSharedObject)g$e301e5e;
	r2->all = r1;
	r4 = (lime__app__$Application)g$_lime_app_Application;
	r3 = r4->current;
	if( !r3 ) goto label$b3b8fb0_1_17;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->onExit;
	if( r5 == NULL ) hl_null_access();
	r6 = &cl$0;
	r7 = NULL;
	r8 = NULL;
	lime_app__Event_Int_Void_add(r5,((vdynamic*)r6),r7,r8);
	label$b3b8fb0_1_17:
	return;
}

void flixel_util__FlxSave_FlxSharedObject_onExit(int r0) {
	haxe__ds__StringMap r2;
	vvirtual *r1, *r4;
	bool r6;
	flixel__util___FlxSave__FlxSharedObject r7;
	flixel__util___FlxSave__$FlxSharedObject r3;
	int *r9;
	vdynamic *r8;
	r3 = (flixel__util___FlxSave__$FlxSharedObject)g$e301e5e;
	r2 = r3->all;
	if( r2 == NULL ) hl_null_access();
	r1 = haxe_ds_StringMap_iterator(r2);
	r4 = hl_to_virtual(&t$vrt_5488975,(vdynamic*)r1);
	label$b3b8fb0_2_5:
	if( r4 == NULL ) hl_null_access();
	if( hl_vfields(r4)[0] ) r6 = ((bool (*)(vdynamic*))hl_vfields(r4)[0])(r4->value); else {
		vdynamic ret;
		hl_dyn_call_obj(r4->value,&t$fun_bf7849e,407283053/*hasNext*/,NULL,&ret);
		r6 = (bool)ret.v.i;
	}
	if( !r6 ) goto label$b3b8fb0_2_14;
	if( hl_vfields(r4)[1] ) r7 = ((flixel__util___FlxSave__FlxSharedObject (*)(vdynamic*))hl_vfields(r4)[1])(r4->value); else {
		r7 = (flixel__util___FlxSave__FlxSharedObject)hl_dyn_call_obj(r4->value,&t$fun_4525c7f,151160317/*next*/,NULL,NULL);
	}
	if( r7 == NULL ) hl_null_access();
	r9 = NULL;
	r8 = flixel_util__FlxSave_FlxSharedObject_flush(r7,r9);
	goto label$b3b8fb0_2_5;
	label$b3b8fb0_2_14:
	return;
}

String flixel_util__FlxSave_FlxSharedObject_getDefaultLocalPath() {
	String r5, r6, r7;
	haxe__ds__StringMap r0;
	openfl__display__MovieClip r3;
	openfl__display__Stage r2;
	lime__app__Application r1;
	vdynamic *r4;
	r3 = openfl_Lib_get_current();
	if( r3 == NULL ) hl_null_access();
	r2 = r3->stage;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->application;
	if( r1 == NULL ) hl_null_access();
	r0 = r1->meta;
	if( r0 == NULL ) hl_null_access();
	r5 = (String)s$company;
	r4 = haxe_ds_StringMap_get(r0,r5);
	r5 = (String)r4;
	if( !r5 ) goto label$b3b8fb0_3_14;
	r7 = (String)s$;
	if( r5 != r7 && (!r5 || !r7 || String___compare(r5,(vdynamic*)r7) != 0) ) goto label$b3b8fb0_3_16;
	label$b3b8fb0_3_14:
	r6 = (String)s$HaxeFlixel;
	goto label$b3b8fb0_3_17;
	label$b3b8fb0_3_16:
	r6 = flixel_util_FlxSave_validate(r5);
	label$b3b8fb0_3_17:
	return r6;
}

openfl__net__SharedObject flixel_util__FlxSave_FlxSharedObject_getLocal(String r0,String r1) {
	vdynobj *r16;
	String r3, r4, r12, r13;
	vvirtual *r18, *r21;
	haxe__ds__StringMap r9;
	bool r8;
	EReg r11;
	flixel__util___FlxSave__FlxSharedObject r15;
	haxe__Unserializer r17;
	flixel__util___FlxSave__$FlxSharedObject r10;
	openfl__errors__Error r5;
	vclosure *r19, *r20;
	vdynamic *r7, *r14, *r22;
	int *r6;
	static vclosure cl$0 = { &t$fun_3522943, Type_resolveEnum, 0 };
	static vclosure cl$1 = { &t$fun_4b98509, openfl_net_SharedObject___resolveClass, 0 };
	hl_trap_ctx trap$0;
	if( !r0 ) goto label$b3b8fb0_4_3;
	r4 = (String)s$;
	if( r0 != r4 && (!r0 || !r4 || String___compare(r0,(vdynamic*)r4) != 0) ) goto label$b3b8fb0_4_11;
	label$b3b8fb0_4_3:
	r5 = (openfl__errors__Error)hl_alloc_obj(&t$openfl_errors_Error);
	r3 = (String)s$Error_Invalid_name_;
	r3 = String___add__(r3,r0);
	r4 = (String)s$4e17057;
	r3 = String___add__(r3,r4);
	r6 = NULL;
	openfl_errors_Error_new(r5,r3,r6);
	hl_throw((vdynamic*)r5);
	label$b3b8fb0_4_11:
	if( r1 ) goto label$b3b8fb0_4_14;
	r3 = (String)s$;
	r1 = r3;
	label$b3b8fb0_4_14:
	r4 = (String)s$6666cd7;
	r3 = String___add__(r1,r4);
	r3 = String___add__(r3,r0);
	flixel_util__FlxSave_FlxSharedObject_init();
	r10 = (flixel__util___FlxSave__$FlxSharedObject)g$e301e5e;
	r9 = r10->all;
	if( r9 == NULL ) hl_null_access();
	r8 = haxe_ds_StringMap_exists(r9,r3);
	if( r8 ) goto label$b3b8fb0_4_73;
	r4 = NULL;
	hl_trap(trap$0,r7,label$b3b8fb0_4_40);
	r11 = (EReg)hl_alloc_obj(&t$EReg);
	r12 = (String)s$f7ed234;
	r13 = (String)s$;
	EReg_new(r11,r12,r13);
	r8 = EReg_match(r11,r1);
	if( !r8 ) goto label$b3b8fb0_4_36;
	r5 = (openfl__errors__Error)hl_alloc_obj(&t$openfl_errors_Error);
	r12 = (String)s$_not_allowed_in_localPath;
	r6 = NULL;
	openfl_errors_Error_new(r5,r12,r6);
	hl_throw((vdynamic*)r5);
	label$b3b8fb0_4_36:
	r12 = flixel_util__FlxSave_FlxSharedObject_getData(r0,r1);
	r4 = r12;
	hl_endtrap(trap$0);
	goto label$b3b8fb0_4_41;
	label$b3b8fb0_4_40:
	r14 = NULL;
	label$b3b8fb0_4_41:
	r13 = (String)s$;
	if( r1 != r13 && (!r1 || !r13 || String___compare(r1,(vdynamic*)r13) != 0) ) goto label$b3b8fb0_4_45;
	r12 = flixel_util__FlxSave_FlxSharedObject_getDefaultLocalPath();
	r1 = r12;
	label$b3b8fb0_4_45:
	r15 = (flixel__util___FlxSave__FlxSharedObject)hl_alloc_obj(&t$flixel_util__FlxSave_FlxSharedObject);
	flixel_util__FlxSave_FlxSharedObject_new(r15);
	r16 = hl_alloc_dynobj();
	r15->data = ((vdynamic*)r16);
	r15->__localPath = r1;
	r15->__name = r0;
	if( !r4 ) goto label$b3b8fb0_4_69;
	r13 = (String)s$;
	if( r4 == r13 || (r4 && r13 && String___compare(r4,(vdynamic*)r13) == 0) ) goto label$b3b8fb0_4_69;
	hl_trap(trap$0,r14,label$b3b8fb0_4_68);
	r17 = (haxe__Unserializer)hl_alloc_obj(&t$haxe_Unserializer);
	haxe_Unserializer_new(r17,r4);
	r18 = hl_alloc_virtual(&t$vrt_fd8054d);
	r19 = &cl$0;
	if( hl_vfields(r18)[1] ) *(vclosure**)(hl_vfields(r18)[1]) = (vclosure*)r19; else hl_dyn_setp(r18->value,-28209272/*resolveEnum*/,&t$fun_3522943,r19);
	r20 = &cl$1;
	if( hl_vfields(r18)[0] ) *(vclosure**)(hl_vfields(r18)[0]) = (vclosure*)r20; else hl_dyn_setp(r18->value,-522339299/*resolveClass*/,&t$fun_4b98509,r20);
	r21 = hl_to_virtual(&t$vrt_6c65511,(vdynamic*)r18);
	haxe_Unserializer_setResolver(r17,r21);
	r14 = haxe_Unserializer_unserialize(r17);
	r15->data = r14;
	hl_endtrap(trap$0);
	goto label$b3b8fb0_4_69;
	label$b3b8fb0_4_68:
	r22 = NULL;
	label$b3b8fb0_4_69:
	r10 = (flixel__util___FlxSave__$FlxSharedObject)g$e301e5e;
	r9 = r10->all;
	if( r9 == NULL ) hl_null_access();
	haxe_ds_StringMap_set(r9,r3,((vdynamic*)r15));
	label$b3b8fb0_4_73:
	r10 = (flixel__util___FlxSave__$FlxSharedObject)g$e301e5e;
	r9 = r10->all;
	if( r9 == NULL ) hl_null_access();
	r7 = haxe_ds_StringMap_get(r9,r3);
	r15 = (flixel__util___FlxSave__FlxSharedObject)r7;
	return ((openfl__net__SharedObject)r15);
}

String flixel_util__FlxSave_FlxSharedObject_getData(String r0,String r1) {
	String r2, r3;
	bool r4;
	r2 = flixel_util__FlxSave_FlxSharedObject_getPath(r1,r0);
	r4 = sys_FileSystem_exists(r2);
	if( !r4 ) goto label$b3b8fb0_5_5;
	r3 = sys_io_File_getContent(r2);
	return r3;
	label$b3b8fb0_5_5:
	r3 = openfl_net_SharedObject___getPath(r1,r0);
	r4 = sys_FileSystem_exists(r3);
	if( !r4 ) goto label$b3b8fb0_5_10;
	r3 = sys_io_File_getContent(r3);
	return r3;
	label$b3b8fb0_5_10:
	r3 = NULL;
	return r3;
}

String flixel_util__FlxSave_FlxSharedObject_getPath(String r0,String r1) {
	String r2, r3, r4, r5, r6;
	hl__types__ArrayObj r12;
	bool r7;
	vdynamic *r9, *r14;
	varray *r15;
	int r8, r10, r11, r13;
	r3 = (String)s$;
	if( r0 != r3 && (!r0 || !r3 || String___compare(r0,(vdynamic*)r3) != 0) ) goto label$b3b8fb0_6_4;
	r2 = flixel_util__FlxSave_FlxSharedObject_getDefaultLocalPath();
	r0 = r2;
	label$b3b8fb0_6_4:
	r2 = lime_system_System_get_applicationStorageDirectory();
	r3 = (String)s$;
	r3 = String___add__(r3,r2);
	r4 = (String)s$ed4e360;
	r3 = String___add__(r3,r4);
	r3 = String___add__(r3,r0);
	r3 = haxe_io_Path_normalize(r3);
	r4 = (String)s$6666cd7;
	r3 = String___add__(r3,r4);
	r5 = (String)s$7bc0ee6;
	r6 = (String)s$6666cd7;
	r4 = StringTools_replace(r1,r5,r6);
	r5 = (String)s$7bc0ee6;
	r6 = (String)s$6666cd7;
	r4 = StringTools_replace(r4,r5,r6);
	r1 = r4;
	r5 = (String)s$6666cd7;
	r7 = StringTools_startsWith(r4,r5);
	if( !r7 ) goto label$b3b8fb0_6_28;
	if( r4 == NULL ) hl_null_access();
	r8 = 1;
	r9 = NULL;
	r4 = String_substr(r4,r8,r9);
	r1 = r4;
	label$b3b8fb0_6_28:
	r5 = (String)s$6666cd7;
	r7 = StringTools_endsWith(r4,r5);
	if( !r7 ) goto label$b3b8fb0_6_39;
	if( r4 == NULL ) hl_null_access();
	r8 = 0;
	r10 = r4->length;
	r11 = 1;
	r10 = r10 - r11;
	r9 = hl_alloc_dynamic(&t$_i32);
	r9->v.i = r10;
	r4 = String_substring(r4,r8,r9);
	r1 = r4;
	label$b3b8fb0_6_39:
	if( r4 == NULL ) hl_null_access();
	r5 = (String)s$6666cd7;
	r9 = NULL;
	r8 = String_indexOf(r4,r5,r9);
	r10 = -1;
	if( r10 >= r8 ) goto label$b3b8fb0_6_86;
	r5 = (String)s$6666cd7;
	r12 = String_split(r4,r5);
	r4 = (String)s$;
	r1 = r4;
	r8 = 0;
	if( r12 == NULL ) hl_null_access();
	r10 = r12->length;
	r11 = 1;
	r10 = r10 - r11;
	label$b3b8fb0_6_54:
	if( r8 >= r10 ) goto label$b3b8fb0_6_73;
	r11 = r8;
	++r8;
	r5 = (String)s$01abfc7;
	if( r12 == NULL ) hl_null_access();
	r13 = r12->length;
	if( ((unsigned)r11) < ((unsigned)r13) ) goto label$b3b8fb0_6_64;
	r6 = NULL;
	goto label$b3b8fb0_6_67;
	label$b3b8fb0_6_64:
	r15 = r12->array;
	r14 = ((vdynamic**)(r15 + 1))[r11];
	r6 = (String)r14;
	label$b3b8fb0_6_67:
	r5 = String___add__(r5,r6);
	r6 = (String)s$6666cd7;
	r5 = String___add__(r5,r6);
	r4 = String___add__(r1,r5);
	r1 = r4;
	goto label$b3b8fb0_6_54;
	label$b3b8fb0_6_73:
	if( r12 == NULL ) hl_null_access();
	r8 = r12->length;
	r10 = 1;
	r8 = r8 - r10;
	r10 = r12->length;
	if( ((unsigned)r8) < ((unsigned)r10) ) goto label$b3b8fb0_6_81;
	r5 = NULL;
	goto label$b3b8fb0_6_84;
	label$b3b8fb0_6_81:
	r15 = r12->array;
	r14 = ((vdynamic**)(r15 + 1))[r8];
	r5 = (String)r14;
	label$b3b8fb0_6_84:
	r4 = String___add__(r1,r5);
	r1 = r4;
	label$b3b8fb0_6_86:
	r4 = String___add__(r3,r1);
	r5 = (String)s$_sol;
	r4 = String___add__(r4,r5);
	return r4;
}

bool flixel_util__FlxSave_FlxSharedObject_exists(String r0,String r1) {
	String r3;
	bool r2;
	r3 = flixel_util__FlxSave_FlxSharedObject_getPath(r0,r1);
	r2 = sys_FileSystem_exists(r3);
	if( r2 ) goto label$b3b8fb0_7_6;
	r3 = openfl_net_SharedObject___getPath(r0,r1);
	r2 = sys_FileSystem_exists(r3);
	return r2;
	label$b3b8fb0_7_6:
	r2 = true;
	return r2;
}

bool flixel_util__FlxSave_FlxSharedObject_newExists(String r0,String r1) {
	String r3;
	bool r2;
	r3 = flixel_util__FlxSave_FlxSharedObject_getPath(r1,r0);
	r2 = sys_FileSystem_exists(r3);
	return r2;
}

String flixel_util__FlxSave_FlxSharedObject_getLegacyPath(String r0,String r1) {
	String r2;
	r2 = openfl_net_SharedObject___getPath(r0,r1);
	return r2;
}

bool flixel_util__FlxSave_FlxSharedObject_legacyExists(String r0,String r1) {
	String r3;
	bool r2;
	r3 = openfl_net_SharedObject___getPath(r1,r0);
	r2 = sys_FileSystem_exists(r3);
	return r2;
}

vdynamic* flixel_util__FlxSave_FlxSharedObject_flush(flixel__util___FlxSave__FlxSharedObject r0,int* r1) {
	bool *r14;
	String r9, r10, r11;
	sys__io__FileOutput r13;
	hl__types__ArrayObj r5;
	venum *r15;
	bool r12;
	vdynamic *r6, *r8, *r16;
	int r2, r4, r7;
	hl_trap_ctx trap$0;
	if( r1 ) goto label$b3b8fb0_11_3;
	r2 = 0;
	goto label$b3b8fb0_11_4;
	label$b3b8fb0_11_3:
	r2 = *r1;
	label$b3b8fb0_11_4:
	r6 = r0->data;
	r5 = Reflect_fields(r6);
	if( r5 == NULL ) hl_null_access();
	r4 = r5->length;
	r7 = 0;
	if( r4 != r7 ) goto label$b3b8fb0_11_13;
	r4 = 0;
	r8 = hl_alloc_dynamic(&t$_i32);
	r8->v.i = r4;
	return r8;
	label$b3b8fb0_11_13:
	r6 = r0->data;
	r9 = haxe_Serializer_run(r6);
	hl_trap(trap$0,r6,label$b3b8fb0_11_32);
	r10 = r0->__localPath;
	r11 = r0->__name;
	r10 = flixel_util__FlxSave_FlxSharedObject_getPath(r10,r11);
	r11 = haxe_io_Path_directory(r10);
	r12 = sys_FileSystem_exists(r11);
	if( r12 ) goto label$b3b8fb0_11_23;
	openfl_net_SharedObject___mkdir(r11);
	label$b3b8fb0_11_23:
	r12 = false;
	r14 = &r12;
	r13 = sys_io_File_write(r10,r14);
	if( r13 == NULL ) hl_null_access();
	r15 = NULL;
	haxe_io_Output_writeString(((haxe__io__Output)r13),r9,r15);
	sys_io_FileOutput_close(r13);
	hl_endtrap(trap$0);
	goto label$b3b8fb0_11_36;
	label$b3b8fb0_11_32:
	r16 = NULL;
	r4 = 1;
	r8 = hl_alloc_dynamic(&t$_i32);
	r8->v.i = r4;
	return r8;
	label$b3b8fb0_11_36:
	r4 = 0;
	r8 = hl_alloc_dynamic(&t$_i32);
	r8->v.i = r4;
	return r8;
}

void flixel_util__FlxSave_FlxSharedObject_clear(flixel__util___FlxSave__FlxSharedObject r0) {
	String r4, r5;
	vdynobj *r1;
	bool r6;
	vdynamic *r2, *r7;
	hl_trap_ctx trap$0;
	r1 = hl_alloc_dynobj();
	r0->data = ((vdynamic*)r1);
	hl_trap(trap$0,r2,label$b3b8fb0_12_11);
	r4 = r0->__localPath;
	r5 = r0->__name;
	r4 = flixel_util__FlxSave_FlxSharedObject_getPath(r4,r5);
	r6 = sys_FileSystem_exists(r4);
	if( !r6 ) goto label$b3b8fb0_12_9;
	sys_FileSystem_deleteFile(r4);
	label$b3b8fb0_12_9:
	hl_endtrap(trap$0);
	goto label$b3b8fb0_12_12;
	label$b3b8fb0_12_11:
	r7 = NULL;
	label$b3b8fb0_12_12:
	return;
}

void flixel_util__FlxSave_FlxSharedObject_new(flixel__util___FlxSave__FlxSharedObject r0) {
	openfl_net_SharedObject_new(((openfl__net__SharedObject)r0));
	return;
}

