// Generated by HLC 4.3.1 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <haxe/zip/HuffTools.h>
#include <haxe/zip/Huffman.h>
#include <hl/types/ArrayObj.h>
extern String s$assert;
extern hl_type t$haxe_zip_Huffman;
extern hl_type t$hl_types_ArrayObj;
void hl_types_ArrayObj_new(hl__types__ArrayObj);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
void haxe_zip_HuffTools_treeWalk(haxe__zip__HuffTools,hl__types__ArrayObj,int,int,int,venum*);
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);
#include <haxe/ds/IntMap.h>
extern String s$Invalid_huffman;
bool haxe_ds_IntMap_exists(haxe__ds__IntMap,int);
vdynamic* haxe_ds_IntMap_get(haxe__ds__IntMap,int);
#include <hl/types/ArrayBytes_Int.h>
extern hl_type t$hl_types_ArrayBytes_Int;
void hl_types_ArrayBytes_Int_new(hl__types__ArrayBytes_Int);
int hl_types_ArrayBytes_Int_push(hl__types__ArrayBytes_Int,int);
void hl_types_ArrayBytes_Int___expand(hl__types__ArrayBytes_Int,int);
extern hl_type t$haxe_ds_IntMap;
void haxe_ds_IntMap_new(haxe__ds__IntMap);
extern hl_type t$_i32;
void haxe_ds_IntMap_set(haxe__ds__IntMap,int,vdynamic*);

void haxe_zip_HuffTools_new(haxe__zip__HuffTools r0) {
	return;
}

int haxe_zip_HuffTools_treeDepth(haxe__zip__HuffTools r0,venum* r1) {
	String r9;
	hl__types__ArrayObj r8;
	venum *r3, *r5;
	int r2, r4, r6, r7;
	if( r1 == NULL ) hl_null_access();
	r2 = HL__ENUM_INDEX__(r1);
	switch(r2) {
		default:
			goto label$aaca80a_2_22;
		case 0:
			r2 = ((haxe_zip_Huffman_Found*)r1)->p0;
			r4 = 0;
			return r4;
		case 1:
			r3 = ((haxe_zip_Huffman_NeedBit*)r1)->p0;
			r5 = ((haxe_zip_Huffman_NeedBit*)r1)->p1;
			r2 = haxe_zip_HuffTools_treeDepth(r0,r3);
			r4 = haxe_zip_HuffTools_treeDepth(r0,r5);
			r6 = 1;
			if( r2 >= r4 ) goto label$aaca80a_2_15;
			r7 = r2;
			goto label$aaca80a_2_16;
			label$aaca80a_2_15:
			r7 = r4;
			label$aaca80a_2_16:
			r6 = r6 + r7;
			return r6;
		case 2:
			r2 = ((haxe_zip_Huffman_NeedBits*)r1)->p0;
			r8 = ((haxe_zip_Huffman_NeedBits*)r1)->p1;
			r9 = (String)s$assert;
			hl_throw((vdynamic*)r9);
	}
	label$aaca80a_2_22:
	r2 = 0;
	return r2;
}

venum* haxe_zip_HuffTools_treeCompress(haxe__zip__HuffTools r0,venum* r1) {
	String r10;
	hl__types__ArrayObj r11;
	venum *r3, *r7, *r8, *r9;
	int r2, r5, r6, r12, r13;
	r2 = haxe_zip_HuffTools_treeDepth(r0,r1);
	r6 = 0;
	if( r2 != r6 ) goto label$aaca80a_3_4;
	return r1;
	label$aaca80a_3_4:
	r6 = 1;
	if( r2 != r6 ) goto label$aaca80a_3_18;
	if( r1 == NULL ) hl_null_access();
	r5 = HL__ENUM_INDEX__(r1);
	r6 = 1;
	if( r5 != r6 ) goto label$aaca80a_3_16;
	r3 = ((haxe_zip_Huffman_NeedBit*)r1)->p0;
	r7 = ((haxe_zip_Huffman_NeedBit*)r1)->p1;
	r8 = haxe_zip_HuffTools_treeCompress(r0,r3);
	r9 = haxe_zip_HuffTools_treeCompress(r0,r7);
	{ venum *tmp;
	tmp = hl_alloc_enum(&t$haxe_zip_Huffman,1);
	((haxe_zip_Huffman_NeedBit*)tmp)->p0 = r8;
	((haxe_zip_Huffman_NeedBit*)tmp)->p1 = r9;
	r8 = tmp; };
	return r8;
	label$aaca80a_3_16:
	r10 = (String)s$assert;
	hl_throw((vdynamic*)r10);
	label$aaca80a_3_18:
	r5 = 1;
	r5 = r5 << r2;
	r11 = (hl__types__ArrayObj)hl_alloc_obj(&t$hl_types_ArrayObj);
	hl_types_ArrayObj_new(r11);
	r6 = 0;
	r12 = r5;
	label$aaca80a_3_24:
	if( r6 >= r12 ) goto label$aaca80a_3_32;
	++r6;
	if( r11 == NULL ) hl_null_access();
	r13 = -1;
	r3 = hl_alloc_enum(&t$haxe_zip_Huffman,0);
	((haxe_zip_Huffman_Found*)r3)->p0 = r13;
	r13 = hl_types_ArrayObj_push(r11,((vdynamic*)r3));
	goto label$aaca80a_3_24;
	label$aaca80a_3_32:
	r6 = 0;
	r12 = 0;
	haxe_zip_HuffTools_treeWalk(r0,r11,r6,r12,r2,r1);
	r3 = hl_alloc_enum(&t$haxe_zip_Huffman,2);
	((haxe_zip_Huffman_NeedBits*)r3)->p0 = r2;
	((haxe_zip_Huffman_NeedBits*)r3)->p1 = r11;
	return r3;
}

void haxe_zip_HuffTools_treeWalk(haxe__zip__HuffTools r0,hl__types__ArrayObj r1,int r2,int r3,int r4,venum* r5) {
	venum *r8, *r10, *r13;
	varray *r14;
	int r7, r9, r11, r12;
	if( r5 == NULL ) hl_null_access();
	r7 = HL__ENUM_INDEX__(r5);
	r9 = 1;
	if( r7 != r9 ) goto label$aaca80a_4_30;
	r8 = ((haxe_zip_Huffman_NeedBit*)r5)->p0;
	r10 = ((haxe_zip_Huffman_NeedBit*)r5)->p1;
	r9 = 0;
	if( r9 >= r4 ) goto label$aaca80a_4_22;
	r11 = 1;
	r9 = r3 + r11;
	r12 = 1;
	r11 = r4 - r12;
	haxe_zip_HuffTools_treeWalk(r0,r1,r2,r9,r11,r8);
	r9 = 1;
	r9 = r9 << r3;
	r7 = r2 | r9;
	r11 = 1;
	r9 = r3 + r11;
	r12 = 1;
	r11 = r4 - r12;
	haxe_zip_HuffTools_treeWalk(r0,r1,r7,r9,r11,r10);
	goto label$aaca80a_4_29;
	label$aaca80a_4_22:
	if( r1 == NULL ) hl_null_access();
	r13 = haxe_zip_HuffTools_treeCompress(r0,r5);
	r9 = r1->length;
	if( ((unsigned)r2) < ((unsigned)r9) ) goto label$aaca80a_4_27;
	hl_types_ArrayObj___expand(r1,r2);
	label$aaca80a_4_27:
	r14 = r1->array;
	((venum**)(r14 + 1))[r2] = r13;
	label$aaca80a_4_29:
	goto label$aaca80a_4_37;
	label$aaca80a_4_30:
	if( r1 == NULL ) hl_null_access();
	r8 = haxe_zip_HuffTools_treeCompress(r0,r5);
	r9 = r1->length;
	if( ((unsigned)r2) < ((unsigned)r9) ) goto label$aaca80a_4_35;
	hl_types_ArrayObj___expand(r1,r2);
	label$aaca80a_4_35:
	r14 = r1->array;
	((venum**)(r14 + 1))[r2] = r8;
	label$aaca80a_4_37:
	return;
}

venum* haxe_zip_HuffTools_treeMake(haxe__zip__HuffTools r0,haxe__ds__IntMap r1,int r2,int r3,int r4) {
	String r7;
	venum *r10, *r14;
	bool r9;
	vdynamic *r8, *r11;
	int r5, r6, r12, r13;
	if( r2 >= r4 ) goto label$aaca80a_5_3;
	r7 = (String)s$Invalid_huffman;
	hl_throw((vdynamic*)r7);
	label$aaca80a_5_3:
	r6 = 5;
	r5 = r3 << r6;
	r5 = r5 | r4;
	if( r1 == NULL ) hl_null_access();
	r9 = haxe_ds_IntMap_exists(r1,r5);
	if( !r9 ) goto label$aaca80a_5_14;
	r8 = haxe_ds_IntMap_get(r1,r5);
	r11 = (vdynamic*)r8;
	r6 = r11 ? r11->v.i : 0;
	r10 = hl_alloc_enum(&t$haxe_zip_Huffman,0);
	((haxe_zip_Huffman_Found*)r10)->p0 = r6;
	return r10;
	label$aaca80a_5_14:
	r12 = 1;
	r6 = r3 << r12;
	r3 = r6;
	++r4;
	r10 = haxe_zip_HuffTools_treeMake(r0,r1,r2,r3,r4);
	r13 = 1;
	r12 = r3 | r13;
	r14 = haxe_zip_HuffTools_treeMake(r0,r1,r2,r12,r4);
	{ venum *tmp;
	tmp = hl_alloc_enum(&t$haxe_zip_Huffman,1);
	((haxe_zip_Huffman_NeedBit*)tmp)->p0 = r10;
	((haxe_zip_Huffman_NeedBit*)tmp)->p1 = r14;
	r10 = tmp; };
	return r10;
}

venum* haxe_zip_HuffTools_make(haxe__zip__HuffTools r0,hl__types__ArrayBytes_Int r1,int r2,int r3,int r4) {
	String r12;
	venum *r8, *r9;
	haxe__ds__IntMap r20;
	hl__types__ArrayBytes_Int r10, r11;
	vdynamic *r22;
	vbyte *r16;
	int r6, r7, r13, r14, r15, r17, r18, r19, r21;
	r7 = 1;
	if( r3 != r7 ) goto label$aaca80a_6_8;
	r6 = 0;
	r8 = hl_alloc_enum(&t$haxe_zip_Huffman,0);
	((haxe_zip_Huffman_Found*)r8)->p0 = r6;
	r6 = 0;
	r9 = hl_alloc_enum(&t$haxe_zip_Huffman,0);
	((haxe_zip_Huffman_Found*)r9)->p0 = r6;
	{ venum *tmp;
	tmp = hl_alloc_enum(&t$haxe_zip_Huffman,1);
	((haxe_zip_Huffman_NeedBit*)tmp)->p0 = r8;
	((haxe_zip_Huffman_NeedBit*)tmp)->p1 = r9;
	r8 = tmp; };
	return r8;
	label$aaca80a_6_8:
	r10 = (hl__types__ArrayBytes_Int)hl_alloc_obj(&t$hl_types_ArrayBytes_Int);
	hl_types_ArrayBytes_Int_new(r10);
	r11 = (hl__types__ArrayBytes_Int)hl_alloc_obj(&t$hl_types_ArrayBytes_Int);
	hl_types_ArrayBytes_Int_new(r11);
	r7 = 32;
	if( r7 >= r4 ) goto label$aaca80a_6_16;
	r12 = (String)s$Invalid_huffman;
	hl_throw((vdynamic*)r12);
	label$aaca80a_6_16:
	r6 = 0;
	r7 = r4;
	label$aaca80a_6_18:
	if( r6 >= r7 ) goto label$aaca80a_6_28;
	++r6;
	if( r10 == NULL ) hl_null_access();
	r14 = 0;
	r14 = hl_types_ArrayBytes_Int_push(r10,r14);
	if( r11 == NULL ) hl_null_access();
	r14 = 0;
	r14 = hl_types_ArrayBytes_Int_push(r11,r14);
	goto label$aaca80a_6_18;
	label$aaca80a_6_28:
	r6 = 0;
	r7 = r3;
	label$aaca80a_6_30:
	if( r6 >= r7 ) goto label$aaca80a_6_58;
	r13 = r6;
	++r6;
	if( r1 == NULL ) hl_null_access();
	r14 = r13 + r2;
	r15 = r1->length;
	if( ((unsigned)r14) < ((unsigned)r15) ) goto label$aaca80a_6_40;
	r14 = 0;
	goto label$aaca80a_6_44;
	label$aaca80a_6_40:
	r16 = r1->bytes;
	r15 = 2;
	r15 = r14 << r15;
	r14 = *(int*)(r16 + r15);
	label$aaca80a_6_44:
	if( r14 < r4 ) goto label$aaca80a_6_47;
	r12 = (String)s$Invalid_huffman;
	hl_throw((vdynamic*)r12);
	label$aaca80a_6_47:
	if( r10 == NULL ) hl_null_access();
	r17 = r10->length;
	if( ((unsigned)r14) < ((unsigned)r17) ) goto label$aaca80a_6_51;
	hl_types_ArrayBytes_Int___expand(r10,r14);
	label$aaca80a_6_51:
	r16 = r10->bytes;
	r17 = 2;
	r17 = r14 << r17;
	r18 = *(int*)(r16 + r17);
	++r18;
	*(int*)(r16 + r17) = r18;
	goto label$aaca80a_6_30;
	label$aaca80a_6_58:
	r6 = 0;
	r7 = 1;
	r14 = 1;
	r13 = r4 - r14;
	label$aaca80a_6_62:
	if( r7 >= r13 ) goto label$aaca80a_6_88;
	r14 = r7;
	++r7;
	if( r10 == NULL ) hl_null_access();
	r18 = r10->length;
	if( ((unsigned)r14) < ((unsigned)r18) ) goto label$aaca80a_6_71;
	r17 = 0;
	goto label$aaca80a_6_75;
	label$aaca80a_6_71:
	r16 = r10->bytes;
	r18 = 2;
	r18 = r14 << r18;
	r17 = *(int*)(r16 + r18);
	label$aaca80a_6_75:
	r15 = r6 + r17;
	r17 = 1;
	r15 = r15 << r17;
	r6 = r15;
	if( r11 == NULL ) hl_null_access();
	r18 = r11->length;
	if( ((unsigned)r14) < ((unsigned)r18) ) goto label$aaca80a_6_83;
	hl_types_ArrayBytes_Int___expand(r11,r14);
	label$aaca80a_6_83:
	r16 = r11->bytes;
	r18 = 2;
	r18 = r14 << r18;
	*(int*)(r16 + r18) = r6;
	goto label$aaca80a_6_62;
	label$aaca80a_6_88:
	r20 = (haxe__ds__IntMap)hl_alloc_obj(&t$haxe_ds_IntMap);
	haxe_ds_IntMap_new(r20);
	r7 = 0;
	r13 = r3;
	label$aaca80a_6_92:
	if( r7 >= r13 ) goto label$aaca80a_6_137;
	r14 = r7;
	++r7;
	if( r1 == NULL ) hl_null_access();
	r15 = r14 + r2;
	r17 = r1->length;
	if( ((unsigned)r15) < ((unsigned)r17) ) goto label$aaca80a_6_102;
	r15 = 0;
	goto label$aaca80a_6_106;
	label$aaca80a_6_102:
	r16 = r1->bytes;
	r17 = 2;
	r17 = r15 << r17;
	r15 = *(int*)(r16 + r17);
	label$aaca80a_6_106:
	r18 = 0;
	if( r15 == r18 ) goto label$aaca80a_6_136;
	if( r11 == NULL ) hl_null_access();
	r18 = 1;
	r17 = r15 - r18;
	r18 = r11->length;
	if( ((unsigned)r17) < ((unsigned)r18) ) goto label$aaca80a_6_115;
	r17 = 0;
	goto label$aaca80a_6_119;
	label$aaca80a_6_115:
	r16 = r11->bytes;
	r18 = 2;
	r18 = r17 << r18;
	r17 = *(int*)(r16 + r18);
	label$aaca80a_6_119:
	r19 = 1;
	r18 = r15 - r19;
	r21 = 1;
	r19 = r17 + r21;
	r21 = r11->length;
	if( ((unsigned)r18) < ((unsigned)r21) ) goto label$aaca80a_6_126;
	hl_types_ArrayBytes_Int___expand(r11,r18);
	label$aaca80a_6_126:
	r16 = r11->bytes;
	r21 = 2;
	r21 = r18 << r21;
	*(int*)(r16 + r21) = r19;
	if( r20 == NULL ) hl_null_access();
	r19 = 5;
	r18 = r17 << r19;
	r18 = r18 | r15;
	r22 = hl_alloc_dynamic(&t$_i32);
	r22->v.i = r14;
	haxe_ds_IntMap_set(r20,r18,((vdynamic*)r22));
	label$aaca80a_6_136:
	goto label$aaca80a_6_92;
	label$aaca80a_6_137:
	r13 = 0;
	r14 = 1;
	r8 = haxe_zip_HuffTools_treeMake(r0,r20,r4,r13,r14);
	r13 = 1;
	r14 = 1;
	r9 = haxe_zip_HuffTools_treeMake(r0,r20,r4,r13,r14);
	{ venum *tmp;
	tmp = hl_alloc_enum(&t$haxe_zip_Huffman,1);
	((haxe_zip_Huffman_NeedBit*)tmp)->p0 = r8;
	((haxe_zip_Huffman_NeedBit*)tmp)->p1 = r9;
	r8 = tmp; };
	r8 = haxe_zip_HuffTools_treeCompress(r0,r8);
	return r8;
}

